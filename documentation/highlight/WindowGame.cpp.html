<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;iostream&gt;</span>

<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"WindowGame.h"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"images.h"</span>

<span style="font-weight: bold"><span style="color: #0000FF">using</span></span> std<span style="color: #990000">:</span><span style="color: #990000">:</span>string<span style="color: #990000">;</span>


<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Constructor.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
WindowGame<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">WindowGame</span></span><span style="color: #990000">(</span>Graphics <span style="color: #990000">&amp;</span>graphics<span style="color: #990000">,</span> Sounds <span style="color: #990000">&amp;</span>sounds<span style="color: #990000">,</span>
                       GameEngine <span style="color: #990000">&amp;</span>engine<span style="color: #990000">)</span>
    <span style="color: #990000">:</span> <span style="font-weight: bold"><span style="color: #000000">Window</span></span><span style="color: #990000">(</span>graphics<span style="color: #990000">,</span> sounds<span style="color: #990000">)</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">gameEngine</span></span><span style="color: #990000">(</span>engine<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>scrollMode <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>moveMode <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>parameterIndex <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>dragDistance <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Create UI Components</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textPlayer <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UIText</span></span><span style="color: #990000">(</span><span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #993399">855</span><span style="color: #990000">,</span> <span style="color: #993399">620</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textPlayers <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UIText</span></span><span style="color: #990000">(</span><span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #993399">857</span><span style="color: #990000">,</span> <span style="color: #993399">100</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textScore <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UIText</span></span><span style="color: #990000">(</span><span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #993399">972</span><span style="color: #990000">,</span> <span style="color: #993399">100</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textWeapon <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UIText</span></span><span style="color: #990000">(</span><span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #993399">855</span><span style="color: #990000">,</span> <span style="color: #993399">680</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textAmmo <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UIText</span></span><span style="color: #990000">(</span><span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #993399">855</span><span style="color: #990000">,</span> <span style="color: #993399">700</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>butWeaponNext <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UIButton</span></span><span style="color: #990000">(</span><span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #FF0000">"&gt;"</span><span style="color: #990000">,</span> <span style="color: #993399">1004</span><span style="color: #990000">,</span> <span style="color: #993399">680</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>butWeaponPrev <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UIButton</span></span><span style="color: #990000">(</span><span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #FF0000">"&lt;"</span><span style="color: #990000">,</span> <span style="color: #993399">840</span><span style="color: #990000">,</span> <span style="color: #993399">680</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textParamTitle <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UIText</span></span><span style="color: #990000">(</span><span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #993399">855</span><span style="color: #990000">,</span> <span style="color: #993399">720</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textParamValue <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UIText</span></span><span style="color: #990000">(</span><span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #993399">855</span><span style="color: #990000">,</span> <span style="color: #993399">740</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>butParamNext <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UIButton</span></span><span style="color: #990000">(</span><span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #FF0000">"&gt;"</span><span style="color: #990000">,</span> <span style="color: #993399">1004</span><span style="color: #990000">,</span> <span style="color: #993399">720</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>butParamPrev <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UIButton</span></span><span style="color: #990000">(</span><span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #FF0000">"&lt;"</span><span style="color: #990000">,</span> <span style="color: #993399">840</span><span style="color: #990000">,</span> <span style="color: #993399">720</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>butParamIncr <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UIButton</span></span><span style="color: #990000">(</span><span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #FF0000">"&gt;"</span><span style="color: #990000">,</span> <span style="color: #993399">1004</span><span style="color: #990000">,</span> <span style="color: #993399">740</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>butParamDecr <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UIButton</span></span><span style="color: #990000">(</span><span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #FF0000">"&lt;"</span><span style="color: #990000">,</span> <span style="color: #993399">840</span><span style="color: #990000">,</span> <span style="color: #993399">740</span><span style="color: #990000">)</span><span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>butMove <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UIButton</span></span><span style="color: #990000">(</span><span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #FF0000">"Move"</span><span style="color: #990000">,</span> <span style="color: #993399">855</span><span style="color: #990000">,</span> <span style="color: #993399">650</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>butQuit <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UIButton</span></span><span style="color: #990000">(</span><span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #FF0000">"End game"</span><span style="color: #990000">,</span> <span style="color: #993399">950</span><span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    
    <span style="font-style: italic"><span style="color: #9A1900">//Read player names</span></span>
    Player <span style="color: #990000">*</span>player<span style="color: #990000">;</span>
    string names<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPlayerCount</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        player <span style="color: #990000">=</span> gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPlayer</span></span><span style="color: #990000">(</span>i<span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>player<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            names<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">append</span></span><span style="color: #990000">(</span>player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getName</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            names<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">append</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"\n"</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textPlayers<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setText</span></span><span style="color: #990000">(</span>names<span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    
    <span style="font-weight: bold"><span style="color: #000000">addComponent</span></span><span style="color: #990000">(</span>textPlayer<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">addComponent</span></span><span style="color: #990000">(</span>textPlayers<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">addComponent</span></span><span style="color: #990000">(</span>textScore<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">addComponent</span></span><span style="color: #990000">(</span>textWeapon<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">addComponent</span></span><span style="color: #990000">(</span>textAmmo<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">addComponent</span></span><span style="color: #990000">(</span>butWeaponNext<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">addComponent</span></span><span style="color: #990000">(</span>butWeaponPrev<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">addComponent</span></span><span style="color: #990000">(</span>textParamTitle<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">addComponent</span></span><span style="color: #990000">(</span>textParamValue<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">addComponent</span></span><span style="color: #990000">(</span>butParamNext<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">addComponent</span></span><span style="color: #990000">(</span>butParamPrev<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">addComponent</span></span><span style="color: #990000">(</span>butParamIncr<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">addComponent</span></span><span style="color: #990000">(</span>butParamDecr<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">addComponent</span></span><span style="color: #990000">(</span>butMove<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">addComponent</span></span><span style="color: #990000">(</span>butQuit<span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

WindowGame<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="color: #990000">~</span><span style="font-weight: bold"><span style="color: #000000">WindowGame</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> textPlayer<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> textPlayers<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> textScore<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> textWeapon<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> textAmmo<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> butWeaponNext<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> butWeaponPrev<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> textParamTitle<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> textParamValue<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> butParamNext<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> butParamPrev<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> butParamIncr<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> butParamDecr<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> butMove<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> butQuit<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Opens game window and starts the game. </span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">int</span> WindowGame<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">open</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Game engine informs game window about changes in it's state with a</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">//callback function:</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setCallbackFunction</span></span><span style="color: #990000">(</span><span style="color: #990000">&amp;</span>WindowGame<span style="color: #990000">:</span><span style="color: #990000">:</span>uiCallback<span style="color: #990000">,</span>
                                         <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">startGame</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    Window<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">open</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Game engine calls this when there is significant state in it's state. </span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param wnd This is a static callback function so 'this' is not available</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> *            and we have to receive it as parameter.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> WindowGame<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">uiCallback</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span> <span style="color: #990000">*</span>wnd<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    WindowGame <span style="color: #990000">*</span>window <span style="color: #990000">=</span> <span style="color: #990000">(</span>WindowGame<span style="color: #990000">*</span><span style="color: #990000">)</span>wnd<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>window <span style="color: #990000">!</span><span style="color: #990000">=</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        window<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>parameterIndex <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        window<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">updateSidebar</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Ends game and closes this window.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> WindowGame<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">endGame</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">endGame</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setCallbackFunction</span></span><span style="color: #990000">(</span>NULL<span style="color: #990000">,</span> NULL<span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Updates player name and weapon info.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> WindowGame<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">updateSidebar</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> Weapon <span style="color: #990000">*</span>selectedWeapon <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    string text<span style="color: #990000">;</span>
    Player <span style="color: #990000">*</span>player<span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Player names (the order may change)</span></span>
    string names<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPlayerCount</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        player <span style="color: #990000">=</span> gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPlayer</span></span><span style="color: #990000">(</span>i<span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>player<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            names<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">append</span></span><span style="color: #990000">(</span>player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getName</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            names<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">append</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"\n"</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textPlayers<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setText</span></span><span style="color: #990000">(</span>names<span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    
    <span style="font-style: italic"><span style="color: #9A1900">//Player in turn</span></span>
    player <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPlayerInTurn</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>player<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textPlayer<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setText</span></span><span style="color: #990000">(</span>player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getName</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        selectedWeapon <span style="color: #990000">=</span> player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getWeaponSelection</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getSelectedWeapon</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>selectedWeapon<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">//Weapon name</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> Projectile <span style="color: #990000">*</span>shot <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getProjectileTemplate</span></span><span style="color: #990000">(</span>selectedWeapon<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getShot</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>shot<span style="color: #990000">)</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textWeapon<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setText</span></span><span style="color: #990000">(</span> shot<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getName</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> 
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textWeapon<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setText</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"-none-"</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Ammo</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textAmmo<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setText</span></span><span style="color: #990000">(</span>selectedWeapon<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getShotCount</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Weapon parameters</span></span>
        ParameterList parameters <span style="color: #990000">=</span> selectedWeapon<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getParameters</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        parameters<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getParameterTitle</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>parameterIndex<span style="color: #990000">,</span> text<span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textParamTitle<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setText</span></span><span style="color: #990000">(</span>text<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">c_str</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        parameters<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getParameterText</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>parameterIndex<span style="color: #990000">,</span> text<span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textParamValue<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setText</span></span><span style="color: #990000">(</span>text<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">c_str</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textWeapon<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setText</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"-none-"</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    
    <span style="font-weight: bold"><span style="color: #000000">updateScore</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Updates score. Energy bars are not UI components so they have to be</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * redrawn every refresh.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> WindowGame<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">updateScore</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Player <span style="color: #990000">*</span>player<span style="color: #990000">;</span>
    string score<span style="color: #990000">;</span>
    <span style="color: #009900">char</span> number<span style="color: #990000">[</span><span style="color: #993399">10</span><span style="color: #990000">]</span><span style="color: #990000">;</span>
    <span style="color: #009900">unsigned</span> <span style="color: #009900">char</span> r<span style="color: #990000">,</span> g<span style="color: #990000">,</span> b<span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">//player color</span></span>
    <span style="color: #009900">int</span> energy<span style="color: #990000">;</span>            <span style="font-style: italic"><span style="color: #9A1900">//player energy</span></span>
    <span style="color: #009900">int</span> red<span style="color: #990000">,</span> green<span style="color: #990000">;</span>        <span style="font-style: italic"><span style="color: #9A1900">//energy bar color</span></span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPlayerCount</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        player <span style="color: #990000">=</span> gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPlayer</span></span><span style="color: #990000">(</span>i<span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>player<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-style: italic"><span style="color: #9A1900">//Print score</span></span>
            <span style="font-weight: bold"><span style="color: #000000">sprintf</span></span><span style="color: #990000">(</span>number<span style="color: #990000">,</span> <span style="color: #FF0000">"%d"</span><span style="color: #990000">,</span> player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getPoints</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            score<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">append</span></span><span style="color: #990000">(</span>number<span style="color: #990000">)</span><span style="color: #990000">;</span>
            score<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">append</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"\n"</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        
            <span style="font-style: italic"><span style="color: #9A1900">//Player color</span></span>
            player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getColor</span></span><span style="color: #990000">(</span>r<span style="color: #990000">,</span> g<span style="color: #990000">,</span> b<span style="color: #990000">)</span><span style="color: #990000">;</span>
            graphics<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">drawRect</span></span><span style="color: #990000">(</span>NULL<span style="color: #990000">,</span> <span style="color: #993399">845</span><span style="color: #990000">,</span> <span style="color: #993399">104</span> <span style="color: #990000">+</span> i <span style="color: #990000">*</span> <span style="color: #993399">18</span><span style="color: #990000">,</span> <span style="color: #993399">5</span><span style="color: #990000">,</span> <span style="color: #993399">5</span><span style="color: #990000">,</span> r<span style="color: #990000">,</span> g<span style="color: #990000">,</span> b<span style="color: #990000">)</span><span style="color: #990000">;</span>
            
            <span style="font-style: italic"><span style="color: #9A1900">//Energy bar</span></span>
            energy <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="color: #990000">(</span>player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getIntegrity</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">*</span> <span style="color: #990000">.</span><span style="color: #993399">10</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            red <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="color: #990000">(</span><span style="color: #993399">512</span> <span style="color: #990000">-</span> player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getIntegrity</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">*</span> <span style="color: #993399">5.12</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            green <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="color: #990000">(</span>player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getIntegrity</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">*</span> <span style="color: #993399">5.12</span><span style="color: #990000">)</span><span style="color: #990000">;</span>

            red <span style="color: #990000">=</span> red <span style="color: #990000">&gt;</span> <span style="color: #993399">255</span> <span style="color: #990000">?</span> <span style="color: #993399">255</span> <span style="color: #990000">:</span> red<span style="color: #990000">;</span>        <span style="font-style: italic"><span style="color: #9A1900">//R max = 255</span></span>
            red <span style="color: #990000">=</span> red <span style="color: #990000">&lt;</span> <span style="color: #993399">0</span> <span style="color: #990000">?</span> <span style="color: #993399">0</span> <span style="color: #990000">:</span> red<span style="color: #990000">;</span>            <span style="font-style: italic"><span style="color: #9A1900">//R min = 0</span></span>
            green <span style="color: #990000">=</span> green <span style="color: #990000">&gt;</span> <span style="color: #993399">255</span> <span style="color: #990000">?</span> <span style="color: #993399">255</span> <span style="color: #990000">:</span> green<span style="color: #990000">;</span>  <span style="font-style: italic"><span style="color: #9A1900">//G max = 255</span></span>
            green <span style="color: #990000">=</span> green <span style="color: #990000">&lt;</span> <span style="color: #993399">0</span> <span style="color: #990000">?</span> <span style="color: #993399">0</span> <span style="color: #990000">:</span> green<span style="color: #990000">;</span>      <span style="font-style: italic"><span style="color: #9A1900">//G min = 0</span></span>

            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getIntegrity</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">&gt;</span> <span style="color: #993399">0</span>  <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span>  player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getCannon</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">!</span><span style="color: #990000">=</span> NULL<span style="color: #990000">)</span>
                graphics<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">drawRect</span></span><span style="color: #990000">(</span>NULL<span style="color: #990000">,</span>
                    <span style="color: #993399">1014</span><span style="color: #990000">,</span> <span style="color: #993399">100</span> <span style="color: #990000">+</span> i <span style="color: #990000">*</span> graphics<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getLineHeight</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">+</span> <span style="color: #993399">10</span> <span style="color: #990000">-</span> energy<span style="color: #990000">,</span>
                    <span style="color: #993399">4</span><span style="color: #990000">,</span> energy <span style="color: #990000">+</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> red<span style="color: #990000">,</span> green<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
                graphics<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">drawRect</span></span><span style="color: #990000">(</span>NULL<span style="color: #990000">,</span>
                    <span style="color: #993399">1014</span><span style="color: #990000">,</span> <span style="color: #993399">100</span> <span style="color: #990000">+</span> i <span style="color: #990000">*</span> graphics<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getLineHeight</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">,</span>
                    <span style="color: #993399">4</span><span style="color: #990000">,</span> <span style="color: #993399">12</span><span style="color: #990000">,</span> <span style="color: #993399">64</span><span style="color: #990000">,</span> <span style="color: #993399">64</span><span style="color: #990000">,</span> <span style="color: #993399">64</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textScore<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setText</span></span><span style="color: #990000">(</span>score<span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Step function is called automatically by Window::open().</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> WindowGame<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">step</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> timestep<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">step</span></span><span style="color: #990000">(</span>timestep<span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>graphics<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">clear</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>                           <span style="font-style: italic"><span style="color: #9A1900">//Clear screen</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">draw</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>graphics<span style="color: #990000">)</span><span style="color: #990000">;</span>            <span style="font-style: italic"><span style="color: #9A1900">//Draw game view</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>graphics<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">drawSprite</span></span><span style="color: #990000">(</span>IMAGE_SIDEBAR<span style="color: #990000">,</span> <span style="color: #993399">824</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">)</span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">//Draw sidebar</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">update</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>                                <span style="font-style: italic"><span style="color: #9A1900">//Draw all UI components</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">updateScore</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>               <span style="font-style: italic"><span style="color: #9A1900">//Draw player colors and energy bars</span></span>

    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getStatus</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">=</span><span style="color: #990000">=</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span>GAMEOVER<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>graphics<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">drawText</span></span><span style="color: #990000">(</span>NULL<span style="color: #990000">,</span> <span style="color: #FF0000">"GAME OVER"</span><span style="color: #990000">,</span> <span style="color: #993399">400</span><span style="color: #990000">,</span> <span style="color: #993399">370</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>graphics<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">update</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Handles key down events</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> WindowGame<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">keyDown</span></span><span style="color: #990000">(</span>SDL_keysym keysym<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>

    Player <span style="color: #990000">*</span>player<span style="color: #990000">;</span>
    Ai <span style="color: #990000">*</span>ai <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    
    player <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPlayerInTurn</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>player<span style="color: #990000">)</span>
        ai <span style="color: #990000">=</span> player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getAI</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        
    <span style="font-style: italic"><span style="color: #9A1900">//If AI is in turn, disable controls</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>ai<span style="color: #990000">)</span>
        player <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getStatus</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">=</span><span style="color: #990000">=</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span>GAMEOVER<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">endGame</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Reset mode</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>moveMode <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//= Common controls =</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">switch</span></span> <span style="color: #990000">(</span>keysym<span style="color: #990000">.</span>sym<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> SDLK_ESCAPE<span style="color: #990000">:</span>
            <span style="font-style: italic"><span style="color: #9A1900">//Esc is disabled for safety</span></span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sounds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">playSound</span></span><span style="color: #990000">(</span>SOUND_TICK<span style="color: #990000">)</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
            
        <span style="font-weight: bold"><span style="color: #0000FF">default</span></span><span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>

    
    <span style="font-style: italic"><span style="color: #9A1900">//= Controls that belong to the player in turn =</span></span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>player <span style="color: #990000">=</span><span style="color: #990000">=</span> NULL<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span><span style="color: #990000">;</span>
        
    <span style="font-weight: bold"><span style="color: #0000FF">switch</span></span> <span style="color: #990000">(</span>keysym<span style="color: #990000">.</span>sym<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> SDLK_SPACE<span style="color: #990000">:</span>
            player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">shoot</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> SDLK_LEFT<span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>keysym<span style="color: #990000">.</span>mod <span style="color: #990000">&amp;</span> KMOD_CTRL<span style="color: #990000">)</span>
                player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">increaseAimingAngle</span></span><span style="color: #990000">(</span><span style="color: #990000">-</span><span style="color: #993399">0.05</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
                player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">increaseAimingAngle</span></span><span style="color: #990000">(</span><span style="color: #990000">-</span><span style="color: #993399">0.2</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> SDLK_RIGHT<span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>keysym<span style="color: #990000">.</span>mod <span style="color: #990000">&amp;</span> KMOD_CTRL<span style="color: #990000">)</span>
                player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">increaseAimingAngle</span></span><span style="color: #990000">(</span><span style="color: #993399">0.05</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
                player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">increaseAimingAngle</span></span><span style="color: #990000">(</span><span style="color: #993399">0.2</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> SDLK_UP<span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>keysym<span style="color: #990000">.</span>mod <span style="color: #990000">&amp;</span> KMOD_CTRL<span style="color: #990000">)</span>
                player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">increaseAimingPower</span></span><span style="color: #990000">(</span><span style="color: #993399">0.05</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
                player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">increaseAimingPower</span></span><span style="color: #990000">(</span><span style="color: #993399">0.1</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
                
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> SDLK_DOWN<span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>keysym<span style="color: #990000">.</span>mod <span style="color: #990000">&amp;</span> KMOD_CTRL<span style="color: #990000">)</span>
                player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">increaseAimingPower</span></span><span style="color: #990000">(</span><span style="color: #990000">-</span><span style="color: #993399">0.05</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
                player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">increaseAimingPower</span></span><span style="color: #990000">(</span><span style="color: #990000">-</span><span style="color: #993399">0.1</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
                
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">default</span></span><span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Handles mouse move events</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> WindowGame<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">mouseMove</span></span><span style="color: #990000">(</span>SDL_MouseMotionEvent motion<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>scrollMode<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//SDL sometimes gives faulty values for relative mouse motion. The</span></span>
        <span style="font-style: italic"><span style="color: #9A1900">//only way to fix the problem seemes to be filtering the values</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>motion<span style="color: #990000">.</span>xrel <span style="color: #990000">&gt;</span> <span style="color: #993399">200</span> <span style="color: #990000">|</span><span style="color: #990000">|</span> motion<span style="color: #990000">.</span>xrel <span style="color: #990000">&lt;</span> <span style="color: #990000">-</span><span style="color: #993399">200</span>
            <span style="color: #990000">|</span><span style="color: #990000">|</span> motion<span style="color: #990000">.</span>yrel <span style="color: #990000">&gt;</span> <span style="color: #993399">200</span> <span style="color: #990000">|</span><span style="color: #990000">|</span> motion<span style="color: #990000">.</span>yrel <span style="color: #990000">&lt;</span> <span style="color: #990000">-</span><span style="color: #993399">200</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Scroll</span></span>
        graphics<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">moveCamera</span></span><span style="color: #990000">(</span>motion<span style="color: #990000">.</span>xrel<span style="color: #990000">,</span> motion<span style="color: #990000">.</span>yrel<span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Odometer for scrolling</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>dragDistance <span style="color: #990000">+</span><span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">sqrt</span></span><span style="color: #990000">(</span><span style="color: #990000">(</span><span style="color: #009900">float</span><span style="color: #990000">)</span><span style="color: #990000">(</span>motion<span style="color: #990000">.</span>xrel <span style="color: #990000">*</span> motion<span style="color: #990000">.</span>xrel
                                         <span style="color: #990000">+</span> motion<span style="color: #990000">.</span>yrel <span style="color: #990000">*</span> motion<span style="color: #990000">.</span>yrel<span style="color: #990000">)</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Handles mouse down events.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> WindowGame<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">mouseDown</span></span><span style="color: #990000">(</span>SDL_MouseButtonEvent button<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-style: italic"><span style="color: #9A1900">//Activate scroll mode</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>button<span style="color: #990000">.</span>x <span style="color: #990000">&lt;</span> <span style="color: #993399">824</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>scrollMode <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">SDL_ShowCursor</span></span><span style="color: #990000">(</span>SDL_DISABLE<span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">SDL_WM_GrabInput</span></span><span style="color: #990000">(</span>SDL_GRAB_ON<span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>dragDistance <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Handles mouse up events.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> WindowGame<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">mouseUp</span></span><span style="color: #990000">(</span>SDL_MouseButtonEvent button<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    UIComponent <span style="color: #990000">*</span>component <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>  <span style="font-style: italic"><span style="color: #9A1900">//Clicked component</span></span>
    Player <span style="color: #990000">*</span>player<span style="color: #990000">;</span>
    Ai <span style="color: #990000">*</span>ai <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    
    player <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPlayerInTurn</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>player<span style="color: #990000">)</span>
        ai <span style="color: #990000">=</span> player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getAI</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        
    <span style="font-style: italic"><span style="color: #9A1900">//If AI is in turn, disable controls</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>ai<span style="color: #990000">)</span>
        player <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Common controls</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>button<span style="color: #990000">.</span>x <span style="color: #990000">&gt;</span> <span style="color: #993399">824</span>  <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span>  <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>scrollMode <span style="color: #990000">=</span><span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        component <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">findComponent</span></span><span style="color: #990000">(</span>button<span style="color: #990000">.</span>x<span style="color: #990000">,</span> button<span style="color: #990000">.</span>y<span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Reset mode to avoid anomalies</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>moveMode <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//'End game' button</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>component <span style="color: #990000">=</span><span style="color: #990000">=</span> butQuit<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sounds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">playSound</span></span><span style="color: #990000">(</span>SOUND_CLICK<span style="color: #990000">)</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">endGame</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Controls that belong to the player in turn</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>button<span style="color: #990000">.</span>x <span style="color: #990000">&gt;</span> <span style="color: #993399">824</span>  <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span>  <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>scrollMode <span style="color: #990000">=</span><span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span>  <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span>  player <span style="color: #990000">!</span><span style="color: #990000">=</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//'Select next weapon' button</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>component <span style="color: #990000">=</span><span style="color: #990000">=</span> butWeaponNext<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sounds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">playSound</span></span><span style="color: #990000">(</span>SOUND_CLICK<span style="color: #990000">)</span><span style="color: #990000">;</span>
            player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">selectWeapon</span></span><span style="color: #990000">(</span><span style="color: #990000">+</span><span style="color: #993399">1</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//'Select previous weapon' button</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>component <span style="color: #990000">=</span><span style="color: #990000">=</span> butWeaponPrev<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sounds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">playSound</span></span><span style="color: #990000">(</span>SOUND_CLICK<span style="color: #990000">)</span><span style="color: #990000">;</span>
            player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">selectWeapon</span></span><span style="color: #990000">(</span><span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//'Select next parameter' button</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>component <span style="color: #990000">=</span><span style="color: #990000">=</span> butParamNext<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sounds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">playSound</span></span><span style="color: #990000">(</span>SOUND_CLICK<span style="color: #990000">)</span><span style="color: #990000">;</span>

            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>parameterIndex<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>parameterIndex <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getWeaponSelection</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getSelectedWeapon</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getParameters</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getParameterCount</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span>
                <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>parameterIndex <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//'Select previous parameter' button</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>component <span style="color: #990000">=</span><span style="color: #990000">=</span> butParamPrev<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sounds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">playSound</span></span><span style="color: #990000">(</span>SOUND_CLICK<span style="color: #990000">)</span><span style="color: #990000">;</span>

            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>parameterIndex<span style="color: #990000">-</span><span style="color: #990000">-</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>parameterIndex <span style="color: #990000">&lt;</span> <span style="color: #993399">0</span><span style="color: #990000">)</span>
                <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>parameterIndex <span style="color: #990000">=</span> <span style="color: #990000">-</span><span style="color: #993399">1</span> <span style="color: #990000">+</span> player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getWeaponSelection</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getSelectedWeapon</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getParameters</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getParameterCount</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//'Increase parameter value' button</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>component <span style="color: #990000">=</span><span style="color: #990000">=</span> butParamIncr<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sounds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">playSound</span></span><span style="color: #990000">(</span>SOUND_CLICK<span style="color: #990000">)</span><span style="color: #990000">;</span>
            
            player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">increaseParameter</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>parameterIndex<span style="color: #990000">,</span> <span style="color: #990000">+</span><span style="color: #993399">1</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//'Decrease parameter value' button</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>component <span style="color: #990000">=</span><span style="color: #990000">=</span> butParamDecr<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sounds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">playSound</span></span><span style="color: #990000">(</span>SOUND_CLICK<span style="color: #990000">)</span><span style="color: #990000">;</span>

            player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">increaseParameter</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>parameterIndex<span style="color: #990000">,</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//'Relocate cannon' button</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>component <span style="color: #990000">=</span><span style="color: #990000">=</span> butMove<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sounds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">playSound</span></span><span style="color: #990000">(</span>SOUND_CLICK<span style="color: #990000">)</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>moveMode <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">updateSidebar</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Handle 'select new location'</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>moveMode  <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span>  button<span style="color: #990000">.</span>x <span style="color: #990000">&lt;</span> <span style="color: #993399">824</span>
        <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span>  dragDistance <span style="color: #990000">&lt;</span> <span style="color: #993399">5</span>  <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span>  player <span style="color: #990000">!</span><span style="color: #990000">=</span> NULL<span style="color: #990000">)</span>
    <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">//Convert to world coordinates</span></span>
        Coordinates<span style="color: #990000">*</span> coords <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>graphics<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getWorldCoordinates</span></span><span style="color: #990000">(</span>button<span style="color: #990000">.</span>x<span style="color: #990000">,</span>
                                                                 button<span style="color: #990000">.</span>y<span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-style: italic"><span style="color: #9A1900">//Set new location</span></span>
        player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setLocation</span></span><span style="color: #990000">(</span>coords<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getX</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">,</span> coords<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getY</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>moveMode <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> coords<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>

    <span style="font-style: italic"><span style="color: #9A1900">//Deactivate scroll mode</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>scrollMode<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">SDL_WM_GrabInput</span></span><span style="color: #990000">(</span>SDL_GRAB_OFF<span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">SDL_ShowCursor</span></span><span style="color: #990000">(</span>SDL_ENABLE<span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>scrollMode <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>
</tt></pre>
