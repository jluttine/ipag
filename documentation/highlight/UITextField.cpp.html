<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;cstring&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"UITextField.h"</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Constructor.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param length Maximum length of content in characters.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
UITextField<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">UITextField</span></span><span style="color: #990000">(</span>Window <span style="color: #990000">&amp;</span>parentWindow<span style="color: #990000">,</span> <span style="color: #009900">unsigned</span> <span style="color: #009900">int</span> length<span style="color: #990000">,</span>
                         <span style="color: #009900">int</span> x<span style="color: #990000">,</span> <span style="color: #009900">int</span> y<span style="color: #990000">)</span>
    <span style="color: #990000">:</span> <span style="font-weight: bold"><span style="color: #000000">UIComponent</span></span><span style="color: #990000">(</span>parentWindow<span style="color: #990000">,</span> x<span style="color: #990000">,</span> y<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    Graphics <span style="color: #990000">*</span>graphics <span style="color: #990000">=</span> parentWindow<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getGraphics</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>image <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>width <span style="color: #990000">=</span> length <span style="color: #990000">*</span> graphics<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getCharWidth</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>height <span style="color: #990000">=</span>  graphics<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getLineHeight</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>maxLength <span style="color: #990000">=</span> length<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Destructor</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
UITextField<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="color: #990000">~</span><span style="font-weight: bold"><span style="color: #000000">UITextField</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Graphics <span style="color: #990000">*</span>graphics <span style="color: #990000">=</span> parentWindow<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getGraphics</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>image<span style="color: #990000">)</span>
        graphics<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">freeSurface</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>image<span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Sets text.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> UITextField<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">setText</span></span><span style="color: #990000">(</span>string <span style="color: #990000">&amp;</span>text<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>content <span style="color: #990000">=</span> text<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #000000">updateImage</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Sets text.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> UITextField<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">setText</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>text<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>text <span style="color: #990000">=</span><span style="color: #990000">=</span> NULL<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>content<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">clear</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>content <span style="color: #990000">=</span> text<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #000000">updateImage</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Clears content.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> UITextField<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">clear</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>content<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">clear</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">updateImage</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Returns copy of the content. Remember to delete the returned string</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * after you are done with it.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @return NULL if component is empty</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">char</span> <span style="color: #990000">*</span>UITextField<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">getText</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">char</span> <span style="color: #990000">*</span>text<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>content<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">length</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">&lt;</span> <span style="color: #993399">1</span><span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> NULL<span style="color: #990000">;</span>
    
    text <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="color: #009900">char</span><span style="color: #990000">[</span>content<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">length</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">]</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>text <span style="color: #990000">=</span><span style="color: #990000">=</span> NULL<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> NULL<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #000000">strcpy</span></span><span style="color: #990000">(</span>text<span style="color: #990000">,</span> content<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">c_str</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> text<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Updates image of the component. Nothing is drawn on the screen. This</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * should be called is text is changed.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> UITextField<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">updateImage</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Graphics <span style="color: #990000">*</span>graphics <span style="color: #990000">=</span> parentWindow<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getGraphics</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Resize the surface</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>width <span style="color: #990000">=</span> content<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">length</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">*</span> graphics<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getCharWidth</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>height <span style="color: #990000">=</span> graphics<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getLineHeight</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Destroy old image and create a new one</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>image <span style="color: #990000">!</span><span style="color: #990000">=</span> NULL<span style="color: #990000">)</span>
        graphics<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">freeSurface</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>image<span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>width <span style="color: #990000">&gt;</span> <span style="color: #993399">0</span> <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>height <span style="color: #990000">&gt;</span> <span style="color: #993399">0</span><span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>image <span style="color: #990000">=</span> graphics<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">createSurface</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>width<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>height<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>image <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Draw text on surface</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>image<span style="color: #990000">)</span>
        graphics<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">drawText</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>image<span style="color: #990000">,</span> content<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">c_str</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Handles key down events.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> UITextField<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">keyDown</span></span><span style="color: #990000">(</span>SDL_keysym keysym<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">unsigned</span> <span style="color: #009900">char</span> c<span style="color: #990000">;</span>
    
    c <span style="color: #990000">=</span> keysym<span style="color: #990000">.</span>sym<span style="color: #990000">;</span>  <span style="font-style: italic"><span style="color: #9A1900">//ASCII character</span></span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Backspace</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>c <span style="color: #990000">=</span><span style="color: #990000">=</span> <span style="color: #993399">8</span> <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span> content<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">length</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">&gt;</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span> 
        content<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">erase</span></span><span style="color: #990000">(</span>content<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">length</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">-</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Limit size</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>content<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">length</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>maxLength<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Capitals</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>keysym<span style="color: #990000">.</span>mod <span style="color: #990000">&amp;</span> KMOD_SHIFT <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span> keysym<span style="color: #990000">.</span>sym <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="color: #FF0000">'a'</span> <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span> keysym<span style="color: #990000">.</span>sym <span style="color: #990000">&lt;</span><span style="color: #990000">=</span> <span style="color: #FF0000">'z'</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        c <span style="color: #990000">-</span><span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #FF0000">'a'</span> <span style="color: #990000">-</span> <span style="color: #FF0000">'A'</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Accept only sensible letters</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="color: #990000">(</span>keysym<span style="color: #990000">.</span>sym <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="color: #FF0000">'a'</span> <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span> keysym<span style="color: #990000">.</span>sym <span style="color: #990000">&lt;</span><span style="color: #990000">=</span> <span style="color: #FF0000">'z'</span><span style="color: #990000">)</span>
        <span style="color: #990000">|</span><span style="color: #990000">|</span> <span style="color: #990000">(</span>keysym<span style="color: #990000">.</span>sym <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="color: #FF0000">'A'</span> <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span> keysym<span style="color: #990000">.</span>sym <span style="color: #990000">&lt;</span><span style="color: #990000">=</span> <span style="color: #FF0000">'Z'</span><span style="color: #990000">)</span>
        <span style="color: #990000">|</span><span style="color: #990000">|</span> <span style="color: #990000">(</span>keysym<span style="color: #990000">.</span>sym <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="color: #FF0000">'0'</span> <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span> keysym<span style="color: #990000">.</span>sym <span style="color: #990000">&lt;</span><span style="color: #990000">=</span> <span style="color: #FF0000">'9'</span><span style="color: #990000">)</span>
        <span style="color: #990000">|</span><span style="color: #990000">|</span> <span style="color: #990000">(</span>keysym<span style="color: #990000">.</span>sym <span style="color: #990000">=</span><span style="color: #990000">=</span> <span style="color: #FF0000">' '</span><span style="color: #990000">)</span>
    <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        content<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">append</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> c<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Update text</span></span>
    <span style="font-weight: bold"><span style="color: #000000">setText</span></span><span style="color: #990000">(</span>content<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">c_str</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre>
