<pre><tt>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;iostream&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;math.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"ProjectileSplitting.h"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"ProjectileSeeking.h"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"ProjectileBouncing.h"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"ProjectileSustaining.h"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"ProjectileShooting.h"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"ProjectileLaser.h"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"ProjectileShootingBouncing.h"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"ProjectileSeekingBouncing.h"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"ProjectileSplittingBouncing.h"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"GameEngine.h"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"BodyPlanet.h"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"Ai.h"</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Constructs a new game engine.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">GameEngine</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>

    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>callbackFunction <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>callbackFunctionParameter <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameWorld <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>playerInTurn <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameStatus <span style="color: #990000">=</span> GAMEOVER<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>endOfRoundPassed <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>endOfRoundStepsTaken <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>endOfRoundTimeRemainder <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>actionTimeRemainder <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>

    <span style="font-style: italic"><span style="color: #9A1900">//Projectile templates:</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">//Two first parameter rows are the basic stuff of projectile (except</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">//Sustaining projectiles). Third and fourth parameter rows are subclass</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">//parameters.</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">push_back</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Projectile</span></span><span style="color: #990000">(</span>
        <span style="color: #FF0000">"Grenade"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Basic grenade."</span><span style="color: #990000">,</span> <span style="color: #993399">100</span><span style="color: #990000">,</span> IMAGE_GRENADE<span style="color: #990000">,</span>
        SOUND_GRENADE<span style="color: #990000">,</span> BodyExplosion<span style="color: #990000">:</span><span style="color: #990000">:</span>SMALL_GAS<span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #993399">15</span><span style="color: #990000">,</span> <span style="color: #993399">40</span> <span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">push_back</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ProjectileLaser</span></span><span style="color: #990000">(</span>
        <span style="color: #FF0000">"Laser"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Basic laser."</span><span style="color: #990000">,</span> <span style="color: #993399">200</span><span style="color: #990000">,</span> IMAGE_LASER<span style="color: #990000">,</span>
        SOUND_LASER<span style="color: #990000">,</span> BodyExplosion<span style="color: #990000">:</span><span style="color: #990000">:</span>LASER<span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">20</span><span style="color: #990000">,</span> <span style="color: #993399">20</span><span style="color: #990000">,</span> <span style="color: #993399">0.9</span> <span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">push_back</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ProjectileBouncing</span></span><span style="color: #990000">(</span>
        <span style="color: #FF0000">"BounZ"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Bouncing shot."</span><span style="color: #990000">,</span> <span style="color: #993399">500</span><span style="color: #990000">,</span> IMAGE_BOUNCING<span style="color: #990000">,</span>
        SOUND_GRENADE<span style="color: #990000">,</span> BodyExplosion<span style="color: #990000">:</span><span style="color: #990000">:</span>SMALL_NUCLEAR<span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #993399">30</span><span style="color: #990000">,</span> <span style="color: #993399">30</span><span style="color: #990000">,</span>
        <span style="color: #993399">5</span><span style="color: #990000">,</span> <span style="color: #993399">0.45</span> <span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">push_back</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ProjectileSeeking</span></span><span style="color: #990000">(</span>
        <span style="color: #FF0000">"Missile"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Seeking missile."</span><span style="color: #990000">,</span> <span style="color: #993399">500</span><span style="color: #990000">,</span> IMAGE_MISSILE<span style="color: #990000">,</span>
        SOUND_ROCKET<span style="color: #990000">,</span> BodyExplosion<span style="color: #990000">:</span><span style="color: #990000">:</span>BIG_GAS<span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #993399">20</span><span style="color: #990000">,</span> <span style="color: #993399">30</span><span style="color: #990000">,</span>
        <span style="color: #993399">100</span><span style="color: #990000">,</span> <span style="color: #993399">0.0007</span> <span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">push_back</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ProjectileSeekingBouncing</span></span><span style="color: #990000">(</span>
        <span style="color: #FF0000">"Frog"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Seeking and bouncing shot."</span><span style="color: #990000">,</span> <span style="color: #993399">1000</span><span style="color: #990000">,</span> IMAGE_FROG<span style="color: #990000">,</span>
        SOUND_GRENADE<span style="color: #990000">,</span> BodyExplosion<span style="color: #990000">:</span><span style="color: #990000">:</span>SMALL_NUCLEAR<span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #993399">25</span><span style="color: #990000">,</span> <span style="color: #993399">30</span><span style="color: #990000">,</span>
        <span style="color: #993399">500</span><span style="color: #990000">,</span> <span style="color: #993399">0.0005</span><span style="color: #990000">,</span> <span style="color: #993399">6</span><span style="color: #990000">,</span> <span style="color: #993399">0.6</span> <span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">push_back</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ProjectileSplitting</span></span><span style="color: #990000">(</span>
        <span style="color: #FF0000">"Splitting grenade"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Splits into four grenades."</span><span style="color: #990000">,</span> <span style="color: #993399">1000</span><span style="color: #990000">,</span> IMAGE_GRENADE<span style="color: #990000">,</span>
        SOUND_GRENADE<span style="color: #990000">,</span> BodyExplosion<span style="color: #990000">:</span><span style="color: #990000">:</span>SMALL_GAS<span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #993399">15</span><span style="color: #990000">,</span> <span style="color: #993399">30</span><span style="color: #990000">,</span>
        <span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]</span><span style="color: #990000">,</span> <span style="color: #993399">4</span><span style="color: #990000">,</span> <span style="color: #993399">1.57</span><span style="color: #990000">,</span> <span style="color: #993399">500</span><span style="color: #990000">,</span> <span style="color: #993399">0.1</span> <span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">push_back</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ProjectileSplittingBouncing</span></span><span style="color: #990000">(</span>
        <span style="color: #FF0000">"Splitting bounZ"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Splits into four bouncing shots."</span><span style="color: #990000">,</span> <span style="color: #993399">1000</span><span style="color: #990000">,</span>
        IMAGE_BOUNCING<span style="color: #990000">,</span> SOUND_GRENADE<span style="color: #990000">,</span> BodyExplosion<span style="color: #990000">:</span><span style="color: #990000">:</span>SMALL_GAS<span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #993399">15</span><span style="color: #990000">,</span> <span style="color: #993399">30</span><span style="color: #990000">,</span>
        <span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">]</span><span style="color: #990000">,</span> <span style="color: #993399">4</span><span style="color: #990000">,</span> <span style="color: #993399">1.57</span><span style="color: #990000">,</span> <span style="color: #993399">300</span><span style="color: #990000">,</span> <span style="color: #993399">0.15</span><span style="color: #990000">,</span>
        ProjectileBouncing<span style="color: #990000">:</span><span style="color: #990000">:</span>maximumBounces<span style="color: #990000">,</span> <span style="color: #993399">1.0</span> <span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">push_back</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ProjectileSplitting</span></span><span style="color: #990000">(</span>
        <span style="color: #FF0000">"Splitting missile"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Splits into three missiles."</span><span style="color: #990000">,</span> <span style="color: #993399">3000</span><span style="color: #990000">,</span> IMAGE_MISSILE<span style="color: #990000">,</span>
        SOUND_GRENADE<span style="color: #990000">,</span> BodyExplosion<span style="color: #990000">:</span><span style="color: #990000">:</span>SMALL_GAS<span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #993399">15</span><span style="color: #990000">,</span> <span style="color: #993399">30</span><span style="color: #990000">,</span>
        <span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">[</span><span style="color: #993399">3</span><span style="color: #990000">]</span><span style="color: #990000">,</span> <span style="color: #993399">3</span><span style="color: #990000">,</span> <span style="color: #993399">1.57</span><span style="color: #990000">,</span> <span style="color: #993399">500</span><span style="color: #990000">,</span> <span style="color: #993399">0.1</span> <span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">push_back</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ProjectileSplittingBouncing</span></span><span style="color: #990000">(</span>
        <span style="color: #FF0000">"Frog squad"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Splits into three frogs."</span><span style="color: #990000">,</span> <span style="color: #993399">3000</span><span style="color: #990000">,</span> IMAGE_FROG<span style="color: #990000">,</span>
        SOUND_GRENADE<span style="color: #990000">,</span> BodyExplosion<span style="color: #990000">:</span><span style="color: #990000">:</span>SMALL_GAS<span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #993399">15</span><span style="color: #990000">,</span> <span style="color: #993399">30</span><span style="color: #990000">,</span>
        <span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">[</span><span style="color: #993399">4</span><span style="color: #990000">]</span><span style="color: #990000">,</span> <span style="color: #993399">3</span><span style="color: #990000">,</span> <span style="color: #993399">1.57</span><span style="color: #990000">,</span> <span style="color: #993399">500</span><span style="color: #990000">,</span> <span style="color: #993399">0.05</span><span style="color: #990000">,</span>
        ProjectileBouncing<span style="color: #990000">:</span><span style="color: #990000">:</span>maximumBounces<span style="color: #990000">,</span> <span style="color: #993399">0.6</span> <span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">push_back</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ProjectileSustaining</span></span><span style="color: #990000">(</span>
        <span style="color: #FF0000">"Grenade fire"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Sustained grenade fire."</span><span style="color: #990000">,</span> <span style="color: #993399">2000</span><span style="color: #990000">,</span>
        <span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]</span><span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">100</span><span style="color: #990000">,</span> <span style="color: #993399">0.1</span> <span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">push_back</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ProjectileSustaining</span></span><span style="color: #990000">(</span>
        <span style="color: #FF0000">"Laser fire"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Sustained laser fire."</span><span style="color: #990000">,</span> <span style="color: #993399">3000</span><span style="color: #990000">,</span>
        <span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]</span><span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">150</span><span style="color: #990000">,</span> <span style="color: #993399">0.1</span> <span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">push_back</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Projectile</span></span><span style="color: #990000">(</span>
        <span style="color: #FF0000">"Nuke"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Extremely effective bomb."</span><span style="color: #990000">,</span> <span style="color: #993399">5000</span><span style="color: #990000">,</span> IMAGE_NUKE<span style="color: #990000">,</span>
        SOUND_ROCKET<span style="color: #990000">,</span> BodyExplosion<span style="color: #990000">:</span><span style="color: #990000">:</span>BIG_NUCLEAR<span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #993399">70</span><span style="color: #990000">,</span> <span style="color: #993399">50</span> <span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">push_back</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ProjectileShooting</span></span><span style="color: #990000">(</span>
        <span style="color: #FF0000">"Grenade probe"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Grenade shooting probe."</span><span style="color: #990000">,</span> <span style="color: #993399">3000</span><span style="color: #990000">,</span> IMAGE_PROBE<span style="color: #990000">,</span>
        SOUND_GRENADE<span style="color: #990000">,</span> BodyExplosion<span style="color: #990000">:</span><span style="color: #990000">:</span>SMALL_GAS<span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">30</span><span style="color: #990000">,</span>
        <span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]</span><span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">400</span><span style="color: #990000">,</span> <span style="color: #993399">0.4</span> <span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">push_back</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ProjectileShooting</span></span><span style="color: #990000">(</span>
        <span style="color: #FF0000">"Laser probe"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Laser shooting probe."</span><span style="color: #990000">,</span> <span style="color: #993399">6000</span><span style="color: #990000">,</span> IMAGE_PROBE<span style="color: #990000">,</span>
        SOUND_GRENADE<span style="color: #990000">,</span> BodyExplosion<span style="color: #990000">:</span><span style="color: #990000">:</span>SMALL_GAS<span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">30</span><span style="color: #990000">,</span>
        <span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]</span><span style="color: #990000">,</span> <span style="color: #993399">6</span><span style="color: #990000">,</span> <span style="color: #993399">400</span><span style="color: #990000">,</span> <span style="color: #993399">0.9</span> <span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">push_back</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ProjectileShooting</span></span><span style="color: #990000">(</span>
        <span style="color: #FF0000">"Missile probe"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Missile shooting probe."</span><span style="color: #990000">,</span> <span style="color: #993399">6000</span><span style="color: #990000">,</span> IMAGE_PROBE<span style="color: #990000">,</span>
        SOUND_GRENADE<span style="color: #990000">,</span> BodyExplosion<span style="color: #990000">:</span><span style="color: #990000">:</span>SMALL_GAS<span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">30</span><span style="color: #990000">,</span> <span style="color: #993399">30</span><span style="color: #990000">,</span>
        <span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">[</span><span style="color: #993399">3</span><span style="color: #990000">]</span><span style="color: #990000">,</span> <span style="color: #993399">6</span><span style="color: #990000">,</span> <span style="color: #993399">400</span><span style="color: #990000">,</span> <span style="color: #993399">0.5</span> <span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">push_back</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ProjectileSplitting</span></span><span style="color: #990000">(</span>
        <span style="color: #FF0000">"Fleet of terror"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Splits into three laser probes."</span><span style="color: #990000">,</span> <span style="color: #993399">12000</span><span style="color: #990000">,</span>
        IMAGE_PROBE<span style="color: #990000">,</span> SOUND_GRENADE<span style="color: #990000">,</span> BodyExplosion<span style="color: #990000">:</span><span style="color: #990000">:</span>SMALL_GAS<span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">30</span><span style="color: #990000">,</span> <span style="color: #993399">30</span><span style="color: #990000">,</span>
        <span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">[</span><span style="color: #993399">13</span><span style="color: #990000">]</span><span style="color: #990000">,</span> <span style="color: #993399">3</span><span style="color: #990000">,</span> <span style="color: #993399">5.7</span><span style="color: #990000">,</span> <span style="color: #993399">500</span><span style="color: #990000">,</span> <span style="color: #993399">0.15</span> <span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">push_back</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ProjectileShootingBouncing</span></span><span style="color: #990000">(</span>
        <span style="color: #FF0000">"Angry toad"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Bouncing and missile shooting probe."</span><span style="color: #990000">,</span> <span style="color: #993399">15000</span><span style="color: #990000">,</span>
        IMAGE_PROBE<span style="color: #990000">,</span> SOUND_GRENADE<span style="color: #990000">,</span> BodyExplosion<span style="color: #990000">:</span><span style="color: #990000">:</span>SMALL_GAS<span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">30</span><span style="color: #990000">,</span>
        <span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">[</span><span style="color: #993399">3</span><span style="color: #990000">]</span><span style="color: #990000">,</span> <span style="color: #993399">6</span><span style="color: #990000">,</span> <span style="color: #993399">1000</span><span style="color: #990000">,</span> <span style="color: #993399">0.5</span><span style="color: #990000">,</span>
        ProjectileBouncing<span style="color: #990000">:</span><span style="color: #990000">:</span>maximumBounces<span style="color: #990000">,</span> <span style="color: #993399">0.8</span> <span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">push_back</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ProjectileShootingBouncing</span></span><span style="color: #990000">(</span>
        <span style="color: #FF0000">"Toad queen"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Bouncing and frog squad shooting probe."</span><span style="color: #990000">,</span> <span style="color: #993399">15000</span><span style="color: #990000">,</span>
        IMAGE_PROBE<span style="color: #990000">,</span> SOUND_GRENADE<span style="color: #990000">,</span> BodyExplosion<span style="color: #990000">:</span><span style="color: #990000">:</span>SMALL_GAS<span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">30</span><span style="color: #990000">,</span>
        <span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">[</span><span style="color: #993399">8</span><span style="color: #990000">]</span><span style="color: #990000">,</span> <span style="color: #993399">4</span><span style="color: #990000">,</span> <span style="color: #993399">1600</span><span style="color: #990000">,</span> <span style="color: #993399">0.25</span><span style="color: #990000">,</span>
        ProjectileBouncing<span style="color: #990000">:</span><span style="color: #990000">:</span>maximumBounces<span style="color: #990000">,</span> <span style="color: #993399">0.8</span> <span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>

<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Destructs the game engine.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="color: #990000">~</span><span style="font-weight: bold"><span style="color: #000000">GameEngine</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameStatus <span style="color: #990000">=</span> GAMEOVER<span style="color: #990000">;</span>

    <span style="font-style: italic"><span style="color: #9A1900">//Remove world.</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameWorld <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameWorld<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameWorld <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        
    <span style="color: #FF0000">}</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Remove players.</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">removeAllPlayers</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>

    <span style="font-style: italic"><span style="color: #9A1900">//Clean projectiles.</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">unsigned</span> <span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span> <span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">[</span>i<span style="color: #990000">]</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">clear</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>

<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Sets the world. Game engine WILL delete the memory allocation of the</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * world after the game.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param world The world for the game.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">setWorld</span></span><span style="color: #990000">(</span> World <span style="color: #990000">&amp;</span>world <span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameWorld <span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameWorld<span style="color: #990000">;</span>
        
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameWorld <span style="color: #990000">=</span> <span style="color: #990000">&amp;</span>world<span style="color: #990000">;</span>
    
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Returns the player of given index or NULL (if invalid index).</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @return The player of given index or NULL for invalid index.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
Player<span style="color: #990000">*</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">getPlayer</span></span><span style="color: #990000">(</span> <span style="color: #009900">int</span> index <span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> index <span style="color: #990000">&lt;</span> <span style="color: #993399">0</span> <span style="color: #990000">|</span><span style="color: #990000">|</span> index <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> NULL<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span>index<span style="color: #990000">]</span><span style="color: #990000">;</span>
    
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Returns the player in turn.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @return The player in turn.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>   
Player <span style="color: #990000">*</span>GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">getPlayerInTurn</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>

    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">&gt;</span> <span style="color: #993399">0</span> <span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>playerInTurn<span style="color: #990000">]</span><span style="color: #990000">;</span>
        
    std<span style="color: #990000">:</span><span style="color: #990000">:</span>cerr <span style="color: #990000">&lt;</span><span style="color: #990000">&lt;</span> <span style="color: #FF0000">"GameEngine::getPlayerInTurn: no players in the game"</span>
              <span style="color: #990000">&lt;</span><span style="color: #990000">&lt;</span> std<span style="color: #990000">:</span><span style="color: #990000">:</span>endl<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> NULL<span style="color: #990000">;</span>

<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Returns the projectile template of given index or NULL for invalid index.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @return Projectile template of given index or NULL for invalid index.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">const</span></span> Projectile<span style="color: #990000">*</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">getProjectileTemplate</span></span><span style="color: #990000">(</span> <span style="color: #009900">int</span> index <span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> index <span style="color: #990000">&lt;</span> <span style="color: #993399">0</span> <span style="color: #990000">|</span><span style="color: #990000">|</span> index <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> NULL<span style="color: #990000">;</span>
        
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>projectileTemplates<span style="color: #990000">[</span>index<span style="color: #990000">]</span><span style="color: #990000">;</span>
    
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Sets the function to call at the beginning of a turn.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param callbackFunction The function to call.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param parameter        The parameter for the function.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>   
<span style="color: #009900">void</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">setCallbackFunction</span></span><span style="color: #990000">(</span> <span style="color: #009900">void</span> <span style="color: #990000">(</span><span style="color: #990000">*</span>callbackFunction<span style="color: #990000">)</span><span style="color: #990000">(</span> <span style="color: #009900">void</span><span style="color: #990000">*</span><span style="color: #990000">)</span><span style="color: #990000">,</span>
                                      <span style="color: #009900">void</span> <span style="color: #990000">*</span>parameter <span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>callbackFunction <span style="color: #990000">=</span> callbackFunction<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>callbackFunctionParameter <span style="color: #990000">=</span> parameter<span style="color: #990000">;</span>
    
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Tries to start the game.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @return Return values are following:</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> *         0: start successful.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> *         -1: game already running (earlier game must end first).</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> *         -2: game does not have enough players.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> *         -3: world has not been created. </span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">int</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">startGame</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameStatus <span style="color: #990000">!</span><span style="color: #990000">=</span> GAMEOVER <span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">;</span>
        
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">&lt;</span><span style="color: #990000">=</span> <span style="color: #993399">1</span> <span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">;</span>
        
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameWorld <span style="color: #990000">=</span><span style="color: #990000">=</span> NULL <span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">;</span>
        
    <span style="font-style: italic"><span style="color: #9A1900">//Zero points.</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span> <span style="color: #009900">unsigned</span> <span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span> <span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span>i<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">clearPoints</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>playerInTurn <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>endOfRoundPassed <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameStatus <span style="color: #990000">=</span> TURN<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">beginTurn</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Ends the game - that is sets the status to GAMEOVER and calculates</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * points and rankings.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">endGame</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameStatus <span style="color: #990000">=</span><span style="color: #990000">=</span> GAMEOVER <span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameStatus <span style="color: #990000">=</span> GAMEOVER<span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Remove players wanting to quit.</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span> <span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">-</span> <span style="color: #993399">1</span><span style="color: #990000">;</span> i <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i<span style="color: #990000">-</span><span style="color: #990000">-</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span>i<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">hasQuitted</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">)</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">removePlayer</span></span><span style="color: #990000">(</span> i <span style="color: #990000">)</span><span style="color: #990000">;</span>
        
    <span style="color: #FF0000">}</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Calculate Last man standing-points.</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span> <span style="color: #009900">unsigned</span> <span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span> <span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span>i<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">calculatePoints</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Calculate rankings.</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span> <span style="color: #009900">unsigned</span> <span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span> <span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span>i<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">calculateRanking</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Sort players.</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">sortPlayers</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Send a signal to game window to make it update the list</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>callbackFunction <span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">callbackFunction</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>callbackFunctionParameter <span style="color: #990000">)</span><span style="color: #990000">;</span>

<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Does end of round procedures.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">endOfRound</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>endOfRoundStepsTaken <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>endOfRoundTimeRemainder <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameStatus <span style="color: #990000">=</span> ENDOFROUND<span style="color: #990000">;</span>

<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Gives the turn to next player. Mainly for game engine's own use. If used</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * outside, it means skipping the turn.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>   
<span style="color: #009900">void</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">nextTurn</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    
    <span style="color: #009900">int</span> previousPlayer <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>playerInTurn<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>playerInTurn<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setActive</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
        
    <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #FF0000">{</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>playerInTurn<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">;</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>playerInTurn <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        
            <span style="font-style: italic"><span style="color: #9A1900">//End of round.</span></span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>playerInTurn <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameStatus <span style="color: #990000">=</span><span style="color: #990000">=</span> TURN <span style="color: #990000">)</span>
                <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">endOfRound</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>endOfRoundPassed <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">;</span>
            
        <span style="color: #FF0000">}</span>
        
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>playerInTurn<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">isDead</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span>
              <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>playerInTurn <span style="color: #990000">!</span><span style="color: #990000">=</span> previousPlayer <span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">beginTurn</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>

<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Starts action phase which continues until no action flagged body exists.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">startAction</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameStatus <span style="color: #990000">=</span><span style="color: #990000">=</span> TURN <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameStatus <span style="color: #990000">=</span> ACTION<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>actionTimeRemainder <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        
    <span style="color: #FF0000">}</span>
    
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Works "identically" with startAction, but all the changes are only</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * simulated - no permanent changes are made. Big difference between these</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * two functions is, that this function returns only after it has completed</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * the simulation.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">simulate</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    
    <span style="color: #009900">int</span> i<span style="color: #990000">;</span>
    <span style="color: #009900">bool</span> isAction <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">;</span>
    Body <span style="color: #990000">*</span>body<span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Notify players of simulation.</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span> <span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span>i<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">startSimulation</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        
    <span style="font-style: italic"><span style="color: #9A1900">//Simulation.</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span> isAction <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>

        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameWorld<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">step</span></span><span style="color: #990000">(</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span>actionStepLength <span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Check whether all action has ended.</span></span>
        i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        isAction <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span> <span style="color: #990000">(</span>body <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameWorld<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getBody</span></span><span style="color: #990000">(</span>i<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">)</span><span style="color: #990000">)</span> <span style="color: #990000">!</span><span style="color: #990000">=</span> NULL <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span> <span style="color: #990000">!</span>isAction <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> body<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getActionFlag</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span> <span style="color: #990000">!</span>body<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">isDestroyed</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">)</span>
                isAction <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">;</span>
            
        <span style="color: #FF0000">}</span>

    <span style="color: #FF0000">}</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Notify players.</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span> <span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span>i<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">endSimulation</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>

<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Allows the game engine to work. Depending on the game status the engine</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * will do a bit different things.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param timestep Delay since last call (ms).</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">step</span></span><span style="color: #990000">(</span> <span style="color: #009900">unsigned</span> <span style="color: #009900">int</span> timestep <span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>

    <span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> Body<span style="color: #990000">*</span> body<span style="color: #990000">;</span>
    <span style="color: #009900">int</span> stepcount <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameStatus <span style="color: #990000">=</span><span style="color: #990000">=</span> ACTION <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Simulate world with constant length steps.</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>actionTimeRemainder <span style="color: #990000">+</span><span style="color: #990000">=</span> timestep<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>actionTimeRemainder <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span>actionStepLength <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameWorld<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">step</span></span><span style="color: #990000">(</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span>actionStepLength <span style="color: #990000">)</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>actionTimeRemainder <span style="color: #990000">-</span><span style="color: #990000">=</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span>actionStepLength<span style="color: #990000">;</span>
            
        <span style="color: #FF0000">}</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Has action ended?</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameStatus <span style="color: #990000">=</span> TURN<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span> <span style="color: #990000">(</span> body <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameWorld<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getBody</span></span><span style="color: #990000">(</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span> <span style="color: #990000">)</span> <span style="color: #990000">)</span> <span style="color: #990000">!</span><span style="color: #990000">=</span> NULL
                <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameStatus <span style="color: #990000">=</span><span style="color: #990000">=</span> TURN <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> body<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getActionFlag</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span> <span style="color: #990000">!</span>body<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">isDestroyed</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">)</span>
                <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameStatus <span style="color: #990000">=</span> ACTION<span style="color: #990000">;</span>
            
        <span style="color: #FF0000">}</span>

        <span style="font-style: italic"><span style="color: #9A1900">//If action is over, begin a new turn.</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameStatus <span style="color: #990000">=</span><span style="color: #990000">=</span> TURN <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">nextTurn</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>

    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameStatus <span style="color: #990000">=</span><span style="color: #990000">=</span> TURN <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Let AI think.</span></span>
        Ai <span style="color: #990000">*</span>computerAI <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>playerInTurn<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getAI</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> computerAI <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            computerAI<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">think</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>        
        <span style="color: #FF0000">}</span>
        
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameStatus <span style="color: #990000">=</span><span style="color: #990000">=</span> ENDOFROUND <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Listn suoritettava aika ja lasketaan montako askelta nyt pitisi</span></span>
        <span style="font-style: italic"><span style="color: #9A1900">//ottaa.</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>endOfRoundTimeRemainder <span style="color: #990000">+</span><span style="color: #990000">=</span> timestep<span style="color: #990000">;</span>
        stepcount <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>endOfRoundTimeRemainder
                    <span style="color: #990000">/</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span>endOfRoundStepLength<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>endOfRoundTimeRemainder <span style="color: #990000">-</span><span style="color: #990000">=</span> stepcount
                                         <span style="color: #990000">*</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span>endOfRoundStepLength<span style="color: #990000">;</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Tutkitaan, onko endofround vaihe suoritettu ja aika siirty vuorovaiheeseen.</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> stepcount <span style="color: #990000">+</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>endOfRoundStepsTaken
             <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span>endOfRoundStepCount <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            stepcount <span style="color: #990000">=</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span>endOfRoundStepCount
                        <span style="color: #990000">-</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>endOfRoundStepsTaken<span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameStatus <span style="color: #990000">=</span> TURN<span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Otetaan askeleita, jos niit on otettavana.</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> stepcount <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameWorld<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">endOfRound</span></span><span style="color: #990000">(</span> <span style="color: #990000">(</span> <span style="color: #009900">float</span> <span style="color: #990000">)</span>stepcount
                                         <span style="color: #990000">/</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span>endOfRoundStepCount <span style="color: #990000">)</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>endOfRoundStepsTaken <span style="color: #990000">+</span><span style="color: #990000">=</span> stepcount<span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        
    <span style="color: #FF0000">}</span>
    
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Checks game over conditions (that is number of players alive is less than</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * two). Ends game if conditions are met.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">checkGameOverConditions</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    
    <span style="color: #009900">int</span> playersAlive <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameStatus <span style="color: #990000">=</span><span style="color: #990000">=</span> GAMEOVER <span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span> <span style="color: #009900">unsigned</span> <span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span> <span style="color: #990000">)</span>
        playersAlive <span style="color: #990000">+</span><span style="color: #990000">=</span> <span style="color: #990000">!</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span>i<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">isDead</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> playersAlive <span style="color: #990000">&lt;</span> <span style="color: #993399">2</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">endGame</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
        
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Begins a new turn. Does the necessary routines.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">beginTurn</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//If game has ended, no new turn will be started.</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">checkGameOverConditions</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameStatus <span style="color: #990000">!</span><span style="color: #990000">=</span> GAMEOVER <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    
        <span style="font-style: italic"><span style="color: #9A1900">//If end of round procedures has been skipped because of turn phase,</span></span>
        <span style="font-style: italic"><span style="color: #9A1900">//do the procedures now.</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>endOfRoundPassed <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>endOfRoundPassed <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">endOfRound</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            
        <span style="color: #FF0000">}</span>
                
        <span style="font-style: italic"><span style="color: #9A1900">//The player in turn must be alive...</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>playerInTurn<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">isDead</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">)</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">nextTurn</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>playerInTurn<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getAI</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">)</span>
          <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>playerInTurn<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getAI</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">startThinking</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>playerInTurn<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setActive</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
            
        <span style="font-style: italic"><span style="color: #9A1900">//If the callback function has been set, call it with the given</span></span>
        <span style="font-style: italic"><span style="color: #9A1900">//parameter.</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>callbackFunction <span style="color: #990000">)</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">callbackFunction</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>callbackFunctionParameter <span style="color: #990000">)</span><span style="color: #990000">;</span>
        
    <span style="color: #FF0000">}</span>
    
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Sorts the players by rankings. First is the player with lowest ranking</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * and last is the player with best ranking.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">sortPlayers</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    
    Player <span style="color: #990000">*</span>player<span style="color: #990000">;</span>
    <span style="color: #009900">int</span> i<span style="color: #990000">,</span> j<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span> i <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span> j <span style="color: #990000">=</span> i <span style="color: #990000">-</span> <span style="color: #993399">1</span><span style="color: #990000">;</span> j <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="color: #993399">0</span>
                         <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span>j<span style="color: #990000">+</span><span style="color: #993399">1</span><span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getRanking</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span>
                            <span style="color: #990000">&lt;</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span>j<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getRanking</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span> j<span style="color: #990000">-</span><span style="color: #990000">-</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            
            player <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span>j<span style="color: #990000">+</span><span style="color: #993399">1</span><span style="color: #990000">]</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span>j<span style="color: #990000">+</span><span style="color: #993399">1</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span>j<span style="color: #990000">]</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span>j<span style="color: #990000">]</span> <span style="color: #990000">=</span> player<span style="color: #990000">;</span>
            
        <span style="color: #FF0000">}</span>
        
    <span style="color: #FF0000">}</span>
    
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Draws the world into graphics.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param graphics The graphics object to draw to.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">draw</span></span><span style="color: #990000">(</span>Graphics <span style="color: #990000">&amp;</span>graphics<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameWorld <span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameWorld<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">draw</span></span><span style="color: #990000">(</span>graphics<span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Tells whether the given player is in the game.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param player The player to look for.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @return Whether the given player is in the game.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">bool</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">hasPlayer</span></span><span style="color: #990000">(</span>Player <span style="color: #990000">&amp;</span>player<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span><span style="color: #FF0000">{</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">unsigned</span> <span style="color: #009900">int</span> i<span style="color: #990000">=</span><span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">)</span><span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">=</span><span style="color: #990000">=</span> <span style="color: #990000">&amp;</span>player<span style="color: #990000">)</span><span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Adds the given player in the game. Does not add same player multiple</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * times. Game engine will clean the player's memory allocation!</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param The player to be add.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">addPlayer</span></span><span style="color: #990000">(</span>Player <span style="color: #990000">&amp;</span>player<span style="color: #990000">)</span><span style="color: #FF0000">{</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="color: #990000">!</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">hasPlayer</span></span><span style="color: #990000">(</span>player<span style="color: #990000">)</span><span style="color: #990000">)</span><span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">push_back</span></span><span style="color: #990000">(</span><span style="color: #990000">&amp;</span>player<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Removes the player of given index from the game.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param index The index of the player to be removed.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">removePlayer</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> index<span style="color: #990000">)</span><span style="color: #FF0000">{</span>

    Player <span style="color: #990000">*</span>player<span style="color: #990000">;</span>
        
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>index <span style="color: #990000">&lt;</span> <span style="color: #993399">0</span> <span style="color: #990000">|</span><span style="color: #990000">|</span> index <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">:</span><span style="color: #990000">:</span>cerr <span style="color: #990000">&lt;</span><span style="color: #990000">&lt;</span> <span style="color: #FF0000">"GameEngine::removePlayer: Invalid index "</span> <span style="color: #990000">&lt;</span><span style="color: #990000">&lt;</span> index<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameStatus <span style="color: #990000">!</span><span style="color: #990000">=</span> GAMEOVER <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span>index<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">quit</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-style: italic"><span style="color: #9A1900">//Tutkitaan, onko pelinaineksia en jljell.</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">checkGameOverConditions</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameStatus <span style="color: #990000">=</span><span style="color: #990000">=</span> TURN <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span> index <span style="color: #990000">=</span><span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>playerInTurn <span style="color: #990000">)</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">nextTurn</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>

    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
        
        player <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span>index<span style="color: #990000">]</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">erase</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">begin</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">+</span> index<span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> player<span style="color: #990000">;</span>
    
    <span style="color: #FF0000">}</span>
    
<span style="color: #FF0000">}</span>   

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Removes the given player from the game - if it is in it.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param player The player to remove.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">removePlayer</span></span><span style="color: #990000">(</span>Player <span style="color: #990000">&amp;</span>player<span style="color: #990000">)</span><span style="color: #FF0000">{</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">unsigned</span> <span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">)</span><span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">=</span><span style="color: #990000">=</span> <span style="color: #990000">&amp;</span>player<span style="color: #990000">)</span><span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">removePlayer</span></span><span style="color: #990000">(</span>i<span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Removes all players from the game.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> GameEngine<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">removeAllPlayers</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #FF0000">{</span>
    
    <span style="color: #009900">int</span> i<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>players<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">-</span> <span style="color: #993399">1</span><span style="color: #990000">;</span> i <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i<span style="color: #990000">-</span><span style="color: #990000">-</span><span style="color: #990000">)</span><span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">removePlayer</span></span><span style="color: #990000">(</span>i<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>
</tt></pre>
