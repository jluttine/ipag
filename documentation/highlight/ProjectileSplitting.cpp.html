<pre><tt>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"BodyProjectile.h"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"ProjectileSplitting.h"</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Constructs a new projectile.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param name                Name of the projectile.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param description         Description of the projectile.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param price               Price of the projectile.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param spriteIndex         Index of the sprite.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param soundIndex          Index of the firing sound.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param explosionIndex      Index of the explosion type.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param radius              Radius of the projectile.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param mass                Mass of the projectile.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param damage              Maximum damage of the projectile.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param damageRadius        Radius of the damage.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param splittingProjectile Projectile template for splitting</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> *                            projectiles.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param splitCount          Number of splitting projectiles.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param splitAngle          Angle of split.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param timeToSplit         Time to split.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param splittingVelocity   Velocity boost for splitting projectiles.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
ProjectileSplitting
    <span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">ProjectileSplitting</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> string <span style="color: #990000">&amp;</span>name<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> string <span style="color: #990000">&amp;</span>description<span style="color: #990000">,</span>
                         <span style="color: #009900">int</span> price<span style="color: #990000">,</span> <span style="color: #009900">int</span> spriteIndex<span style="color: #990000">,</span> <span style="color: #009900">int</span> soundIndex<span style="color: #990000">,</span>
                         BodyExplosion<span style="color: #990000">:</span><span style="color: #990000">:</span>EType explosionIndex<span style="color: #990000">,</span> <span style="color: #009900">float</span> radius<span style="color: #990000">,</span>
                         <span style="color: #009900">float</span> mass<span style="color: #990000">,</span> <span style="color: #009900">float</span> damage<span style="color: #990000">,</span> <span style="color: #009900">float</span> damageRadius<span style="color: #990000">,</span>
                         Projectile <span style="color: #990000">&amp;</span>splittingProjectile<span style="color: #990000">,</span> <span style="color: #009900">int</span> splitCount<span style="color: #990000">,</span>
                         <span style="color: #009900">float</span> splitAngle<span style="color: #990000">,</span> <span style="color: #009900">int</span> timeToSplit<span style="color: #990000">,</span>
                         <span style="color: #009900">float</span> splittingVelocity <span style="color: #990000">)</span>
    <span style="color: #990000">:</span> <span style="font-weight: bold"><span style="color: #000000">Projectile</span></span><span style="color: #990000">(</span> name<span style="color: #990000">,</span> description<span style="color: #990000">,</span> price<span style="color: #990000">,</span> spriteIndex<span style="color: #990000">,</span> soundIndex<span style="color: #990000">,</span>
                  explosionIndex<span style="color: #990000">,</span> radius<span style="color: #990000">,</span> mass<span style="color: #990000">,</span> damage<span style="color: #990000">,</span> damageRadius <span style="color: #990000">)</span><span style="color: #990000">,</span>
      <span style="font-weight: bold"><span style="color: #000000">splittingProjectile</span></span><span style="color: #990000">(</span> splittingProjectile <span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    
    Angle<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">fix</span></span><span style="color: #990000">(</span> splitAngle <span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>splitCount <span style="color: #990000">=</span> splitCount<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>splittingVelocity <span style="color: #990000">=</span> splittingVelocity<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>indexSplittingTime <span style="color: #990000">=</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>parameters<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addParameter</span></span><span style="color: #990000">(</span> ParameterList<span style="color: #990000">:</span><span style="color: #990000">:</span>TIME<span style="color: #990000">,</span> <span style="color: #FF0000">"Split time"</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span>
                                       <span style="color: #993399">100</span><span style="color: #990000">,</span> <span style="color: #993399">50</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>indexSplittingAngle <span style="color: #990000">=</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>parameters<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addParameter</span></span><span style="color: #990000">(</span> ParameterList<span style="color: #990000">:</span><span style="color: #990000">:</span>ANGLE<span style="color: #990000">,</span> <span style="color: #FF0000">"Split angle"</span><span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">,</span>
                                       <span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">36</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>parameters<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setParameterValue</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>indexSplittingTime<span style="color: #990000">,</span> timeToSplit<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>parameters<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setParameterValue</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>indexSplittingAngle<span style="color: #990000">,</span>
                                        <span style="color: #990000">(</span> <span style="color: #009900">int</span> <span style="color: #990000">)</span><span style="color: #990000">(</span> <span style="color: #993399">180</span> <span style="color: #990000">*</span> splitAngle <span style="color: #990000">/</span> M_PI <span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>

<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Constructs a projectile with same properties.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param copy The projectile to use as a copy.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
ProjectileSplitting<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">ProjectileSplitting</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> ProjectileSplitting <span style="color: #990000">&amp;</span>copy <span style="color: #990000">)</span>
    <span style="color: #990000">:</span> <span style="font-weight: bold"><span style="color: #000000">Projectile</span></span><span style="color: #990000">(</span> copy <span style="color: #990000">)</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">splittingProjectile</span></span><span style="color: #990000">(</span> copy<span style="color: #990000">.</span>splittingProjectile <span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>splitCount <span style="color: #990000">=</span> copy<span style="color: #990000">.</span>splitCount<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>splittingVelocity <span style="color: #990000">=</span> copy<span style="color: #990000">.</span>splittingVelocity<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>indexSplittingTime <span style="color: #990000">=</span> copy<span style="color: #990000">.</span>indexSplittingTime<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>indexSplittingAngle <span style="color: #990000">=</span> copy<span style="color: #990000">.</span>indexSplittingAngle<span style="color: #990000">;</span>
    
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Simulates the timestep for the capsule.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param timestep The step length in ms.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param capsule  The capsule, that is the projectile in the world.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> ProjectileSplitting<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">step</span></span><span style="color: #990000">(</span> <span style="color: #009900">int</span> timestep<span style="color: #990000">,</span> BodyProjectile <span style="color: #990000">&amp;</span>capsule <span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    
    Vector <span style="font-weight: bold"><span style="color: #000000">velocity</span></span><span style="color: #990000">(</span> capsule<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getVelocity</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="color: #009900">float</span> splitAngle <span style="color: #990000">=</span>
        M_PI <span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>parameters<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getParameterValue</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>indexSplittingAngle <span style="color: #990000">)</span>
        <span style="color: #990000">/</span> <span style="color: #993399">180.0</span><span style="color: #990000">;</span>
        
    <span style="color: #009900">float</span> stepAngle <span style="color: #990000">=</span>  splitAngle <span style="color: #990000">/</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>splitCount<span style="color: #990000">;</span>
    
    velocity<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">scale</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>splittingVelocity <span style="color: #990000">/</span> velocity<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getLength</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    velocity<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">rotate</span></span><span style="color: #990000">(</span> <span style="color: #990000">(</span> stepAngle <span style="color: #990000">-</span> splitAngle <span style="color: #990000">)</span> <span style="color: #990000">/</span> <span style="color: #993399">2</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>timeLived
         <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>parameters<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getParameterValue</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>indexSplittingTime <span style="color: #990000">)</span> <span style="color: #990000">)</span>
    <span style="color: #FF0000">{</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span> <span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>splitCount<span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                
            Projectile <span style="color: #990000">*</span>model <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>splittingProjectile<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getCopy</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            model<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setShooter</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getShooter</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
            
            BodyProjectile <span style="color: #990000">*</span>newProjectile <span style="color: #990000">=</span>
                <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">BodyProjectile</span></span><span style="color: #990000">(</span> capsule<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getWorld</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">,</span>
                                    capsule<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getLocation</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getX</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">,</span>
                                  capsule<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getLocation</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getY</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">,</span> <span style="color: #990000">*</span>model <span style="color: #990000">)</span><span style="color: #990000">;</span>

            newProjectile<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setVelocity</span></span><span style="color: #990000">(</span>
                capsule<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getVelocity</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getX</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">+</span> velocity<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getX</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">,</span>
                capsule<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getVelocity</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getY</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">+</span> velocity<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getY</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
                
            velocity<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">rotate</span></span><span style="color: #990000">(</span> stepAngle <span style="color: #990000">)</span><span style="color: #990000">;</span>

            newProjectile<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setActionFlag</span></span><span style="color: #990000">(</span> capsule<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getActionFlag</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
            capsule<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getWorld</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addBody</span></span><span style="color: #990000">(</span> <span style="color: #990000">*</span>newProjectile <span style="color: #990000">)</span><span style="color: #990000">;</span>
            
        <span style="color: #FF0000">}</span>
        
        capsule<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">destroy</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        
    <span style="color: #FF0000">}</span>
    
    Projectile<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">step</span></span><span style="color: #990000">(</span> timestep<span style="color: #990000">,</span> capsule <span style="color: #990000">)</span><span style="color: #990000">;</span>
    
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Forms a string to describe the damage of the projectile.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param text String to store the damage description.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> ProjectileSplitting<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">getDamageText</span></span><span style="color: #990000">(</span> std<span style="color: #990000">:</span><span style="color: #990000">:</span>string <span style="color: #990000">&amp;</span>text <span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span>
<span style="color: #FF0000">{</span>
    
    <span style="color: #009900">char</span> buffer<span style="color: #990000">[</span><span style="color: #993399">80</span><span style="color: #990000">]</span><span style="color: #990000">;</span>
    std<span style="color: #990000">:</span><span style="color: #990000">:</span>string damage<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>splittingProjectile<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getDamageText</span></span><span style="color: #990000">(</span> damage <span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">sprintf</span></span><span style="color: #990000">(</span> buffer<span style="color: #990000">,</span> <span style="color: #FF0000">"%dx%s"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>splitCount<span style="color: #990000">,</span> damage<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">c_str</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    text <span style="color: #990000">=</span> buffer<span style="color: #990000">;</span>
    
<span style="color: #FF0000">}</span>

</tt></pre>
