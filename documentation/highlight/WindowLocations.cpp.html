<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"Ai.h"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"WindowLocations.h"</span>


<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Constructor</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
WindowLocations<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">WindowLocations</span></span><span style="color: #990000">(</span>Graphics <span style="color: #990000">&amp;</span>graphics<span style="color: #990000">,</span> Sounds <span style="color: #990000">&amp;</span>sounds<span style="color: #990000">,</span>
                                 GameEngine <span style="color: #990000">&amp;</span>engine<span style="color: #990000">)</span>
    <span style="color: #990000">:</span> <span style="font-weight: bold"><span style="color: #000000">Window</span></span><span style="color: #990000">(</span>graphics<span style="color: #990000">,</span> sounds<span style="color: #990000">)</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">gameEngine</span></span><span style="color: #990000">(</span>engine<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>scrollMode <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Create UI components</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textTip <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UIText</span></span><span style="color: #990000">(</span><span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #FF0000">"Choose location for"</span><span style="color: #990000">,</span> <span style="color: #993399">300</span><span style="color: #990000">,</span> <span style="color: #993399">20</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textPlayer <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UIText</span></span><span style="color: #990000">(</span><span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #993399">460</span><span style="color: #990000">,</span> <span style="color: #993399">20</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textPlayers <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UIText</span></span><span style="color: #990000">(</span><span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #993399">865</span><span style="color: #990000">,</span> <span style="color: #993399">100</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>butNext <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UIButton</span></span><span style="color: #990000">(</span><span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #FF0000">"Skip round"</span><span style="color: #990000">,</span> <span style="color: #993399">858</span><span style="color: #990000">,</span> <span style="color: #993399">300</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>butQuit <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UIButton</span></span><span style="color: #990000">(</span><span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #FF0000">"Back to main menu"</span><span style="color: #990000">,</span> <span style="color: #993399">858</span><span style="color: #990000">,</span> <span style="color: #993399">730</span><span style="color: #990000">)</span><span style="color: #990000">;</span>

    <span style="font-style: italic"><span style="color: #9A1900">//Read player names</span></span>
    Player <span style="color: #990000">*</span>player<span style="color: #990000">;</span>
    string names<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPlayerCount</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        player <span style="color: #990000">=</span> gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPlayer</span></span><span style="color: #990000">(</span>i<span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>player<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            names<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">append</span></span><span style="color: #990000">(</span>player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getName</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            names<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">append</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"\n"</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textPlayers<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setText</span></span><span style="color: #990000">(</span>names<span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #000000">addComponent</span></span><span style="color: #990000">(</span>textPlayer<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">addComponent</span></span><span style="color: #990000">(</span>textTip<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">addComponent</span></span><span style="color: #990000">(</span>textPlayers<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">addComponent</span></span><span style="color: #990000">(</span>butNext<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">addComponent</span></span><span style="color: #990000">(</span>butQuit<span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Activate first player</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>playerInTurn <span style="color: #990000">=</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">nextPlayer</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Destructor</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
WindowLocations<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="color: #990000">~</span><span style="font-weight: bold"><span style="color: #000000">WindowLocations</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> textPlayer<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> textTip<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> textPlayers<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> butNext<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> butQuit<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Step is called automatically by window::open().</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> WindowLocations<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">step</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> timestep<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>graphics<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">clear</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>                           <span style="font-style: italic"><span style="color: #9A1900">//Clear screen</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">draw</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>graphics<span style="color: #990000">)</span><span style="color: #990000">;</span>            <span style="font-style: italic"><span style="color: #9A1900">//Draw game view</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>graphics<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">drawSprite</span></span><span style="color: #990000">(</span>IMAGE_SIDEBAR<span style="color: #990000">,</span> <span style="color: #993399">824</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">)</span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">//Draw sidebar</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">update</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>                                   <span style="font-style: italic"><span style="color: #9A1900">//Draw UI components</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">drawPlayerColors</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>                         <span style="font-style: italic"><span style="color: #9A1900">//Draw colors</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>graphics<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">update</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>                          <span style="font-style: italic"><span style="color: #9A1900">//Update screen</span></span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Draws player colors on the sidebar. The boxes are not UI components</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * so they have to be redrawn every refresh.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> WindowLocations<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">drawPlayerColors</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Player <span style="color: #990000">*</span>player<span style="color: #990000">;</span>
    <span style="color: #009900">unsigned</span> <span style="color: #009900">char</span> r<span style="color: #990000">,</span> g<span style="color: #990000">,</span> b<span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">//player color</span></span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPlayerCount</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        player <span style="color: #990000">=</span> gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPlayer</span></span><span style="color: #990000">(</span>i<span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>player<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getColor</span></span><span style="color: #990000">(</span>r<span style="color: #990000">,</span> g<span style="color: #990000">,</span> b<span style="color: #990000">)</span><span style="color: #990000">;</span>
            graphics<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">drawRect</span></span><span style="color: #990000">(</span>NULL<span style="color: #990000">,</span>
                <span style="color: #993399">850</span><span style="color: #990000">,</span> <span style="color: #993399">104</span> <span style="color: #990000">+</span> i <span style="color: #990000">*</span> graphics<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getLineHeight</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">,</span>
                <span style="color: #993399">5</span><span style="color: #990000">,</span> <span style="color: #993399">5</span><span style="color: #990000">,</span> r<span style="color: #990000">,</span> g<span style="color: #990000">,</span> b<span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Handles key down events</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> WindowLocations<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">keyDown</span></span><span style="color: #990000">(</span>SDL_keysym keysym<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">switch</span></span> <span style="color: #990000">(</span>keysym<span style="color: #990000">.</span>sym<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> SDLK_ESCAPE<span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
            
        <span style="font-weight: bold"><span style="color: #0000FF">default</span></span><span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Handles mouse move events</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> WindowLocations<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">mouseMove</span></span><span style="color: #990000">(</span>SDL_MouseMotionEvent motion<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>scrollMode<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Workaround for a bug most likely in SDL</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>motion<span style="color: #990000">.</span>xrel <span style="color: #990000">&gt;</span> <span style="color: #993399">200</span> <span style="color: #990000">|</span><span style="color: #990000">|</span> motion<span style="color: #990000">.</span>xrel <span style="color: #990000">&lt;</span> <span style="color: #990000">-</span><span style="color: #993399">200</span>
            <span style="color: #990000">|</span><span style="color: #990000">|</span> motion<span style="color: #990000">.</span>yrel <span style="color: #990000">&gt;</span> <span style="color: #993399">200</span> <span style="color: #990000">|</span><span style="color: #990000">|</span> motion<span style="color: #990000">.</span>yrel <span style="color: #990000">&lt;</span> <span style="color: #990000">-</span><span style="color: #993399">200</span><span style="color: #990000">)</span>
        <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Scroll</span></span>
        graphics<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">moveCamera</span></span><span style="color: #990000">(</span>motion<span style="color: #990000">.</span>xrel<span style="color: #990000">,</span> motion<span style="color: #990000">.</span>yrel<span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Odometer</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>dragDistance <span style="color: #990000">+</span><span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">sqrt</span></span><span style="color: #990000">(</span><span style="color: #990000">(</span><span style="color: #009900">float</span><span style="color: #990000">)</span><span style="color: #990000">(</span>motion<span style="color: #990000">.</span>xrel <span style="color: #990000">*</span> motion<span style="color: #990000">.</span>xrel
                                         <span style="color: #990000">+</span> motion<span style="color: #990000">.</span>yrel <span style="color: #990000">*</span> motion<span style="color: #990000">.</span>yrel<span style="color: #990000">)</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Handles mouse down events</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> WindowLocations<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">mouseDown</span></span><span style="color: #990000">(</span>SDL_MouseButtonEvent button<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-style: italic"><span style="color: #9A1900">//Activate scroll mode</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>button<span style="color: #990000">.</span>x <span style="color: #990000">&lt;</span> <span style="color: #993399">824</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>scrollMode <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">SDL_ShowCursor</span></span><span style="color: #990000">(</span>SDL_DISABLE<span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">SDL_WM_GrabInput</span></span><span style="color: #990000">(</span>SDL_GRAB_ON<span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>dragDistance <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Handles mouse up events</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> WindowLocations<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">mouseUp</span></span><span style="color: #990000">(</span>SDL_MouseButtonEvent button<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>button<span style="color: #990000">.</span>x <span style="color: #990000">&gt;</span> <span style="color: #993399">824</span>  <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span>  <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>scrollMode <span style="color: #990000">=</span><span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">//Clicking sidebar. Find out if a component was hit.</span></span>
        UIComponent <span style="color: #990000">*</span>component <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">findComponent</span></span><span style="color: #990000">(</span>button<span style="color: #990000">.</span>x<span style="color: #990000">,</span> button<span style="color: #990000">.</span>y<span style="color: #990000">)</span><span style="color: #990000">;</span>

        <span style="font-style: italic"><span style="color: #9A1900">//'Next player' button</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>component <span style="color: #990000">=</span><span style="color: #990000">=</span> butNext<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>playerInTurn <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPlayerCount</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span>
                <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">startGame</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">nextPlayer</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//'Back to main menu' button</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>component <span style="color: #990000">=</span><span style="color: #990000">=</span> butQuit<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">//Clicking game area</span></span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Convert to world coordinates</span></span>
        Coordinates<span style="color: #990000">*</span> coords <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>graphics<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getWorldCoordinates</span></span><span style="color: #990000">(</span>button<span style="color: #990000">.</span>x<span style="color: #990000">,</span> button<span style="color: #990000">.</span>y<span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        Player <span style="color: #990000">*</span>player<span style="color: #990000">;</span>
        Ai <span style="color: #990000">*</span>ai <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        player <span style="color: #990000">=</span> gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPlayer</span></span><span style="color: #990000">(</span>playerInTurn<span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>player<span style="color: #990000">)</span>
            ai <span style="color: #990000">=</span> player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getAI</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//If AI is in turn, disable controls</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>ai<span style="color: #990000">)</span>
            player <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
            
        <span style="font-style: italic"><span style="color: #9A1900">//Set location</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>player  <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span>  <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>dragDistance <span style="color: #990000">&lt;</span> <span style="color: #993399">5</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setLocation</span></span><span style="color: #990000">(</span>coords<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getX</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">,</span> coords<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getY</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span> <span style="color: #990000">=</span><span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sounds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">playSound</span></span><span style="color: #990000">(</span>SOUND_CLICK<span style="color: #990000">)</span><span style="color: #990000">;</span>
                <span style="font-weight: bold"><span style="color: #000000">nextPlayer</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sounds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">playSound</span></span><span style="color: #990000">(</span>SOUND_TICK<span style="color: #990000">)</span><span style="color: #990000">;</span>
            <span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> coords<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>

    <span style="font-style: italic"><span style="color: #9A1900">//Deactivate scroll mode</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>scrollMode<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">SDL_WM_GrabInput</span></span><span style="color: #990000">(</span>SDL_GRAB_OFF<span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">SDL_ShowCursor</span></span><span style="color: #990000">(</span>SDL_ENABLE<span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>scrollMode <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Activates next player. </span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> WindowLocations<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">nextPlayer</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Player <span style="color: #990000">*</span>player<span style="color: #990000">;</span>
    
    playerInTurn<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">;</span>
    player <span style="color: #990000">=</span> gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPlayer</span></span><span style="color: #990000">(</span>playerInTurn<span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>playerInTurn <span style="color: #990000">&lt;</span> gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPlayerCount</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textPlayer<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setText</span></span><span style="color: #990000">(</span>gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPlayer</span></span><span style="color: #990000">(</span>playerInTurn<span style="color: #990000">)</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getName</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">//If this was the last player</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textPlayer<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">clear</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textTip<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">clear</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>butNext<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setText</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Finish"</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//If it's an AI, let it choose it's position</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>player<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        Ai <span style="color: #990000">*</span>ai<span style="color: #990000">;</span>
        ai <span style="color: #990000">=</span> player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getAI</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>ai<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            ai<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">selectStartingLocation</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #000000">nextPlayer</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Starts game and closes this window.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> WindowLocations<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">startGame</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Selects random locations for all players.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> WindowLocations<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">randomLocations</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">int</span> i<span style="color: #990000">,</span> j<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPlayerCount</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        Player<span style="color: #990000">*</span> player <span style="color: #990000">=</span> gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPlayer</span></span><span style="color: #990000">(</span>i<span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>j <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> j <span style="color: #990000">&lt;</span> <span style="color: #993399">20</span> <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span> player<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setLocation</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">rand</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">rand</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span> <span style="color: #990000">=</span><span style="color: #990000">=</span> <span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">;</span> j<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    
    playerInTurn <span style="color: #990000">=</span> gameEngine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPlayerCount</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>textPlayer<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">clear</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre>
