<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;iostream&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;fstream&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;math.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"Graphics.h"</span>

<span style="font-style: italic"><span style="color: #9A1900">//Number of stars</span></span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> STARS  <span style="color: #993399">400</span>

<span style="font-style: italic"><span style="color: #9A1900">//Text properties</span></span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> LINE_HEIGHT  <span style="color: #993399">18</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> CHAR_WIDTH   <span style="color: #993399">8</span>

<span style="font-weight: bold"><span style="color: #0000FF">using</span></span> <span style="font-weight: bold"><span style="color: #0000FF">namespace</span></span> std<span style="color: #990000">;</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Constructor.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">Graphics</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>windowCenter <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>font <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>stars <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>starfieldCenterX <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>starfieldCenterY <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="color: #990000">~</span><span style="font-weight: bold"><span style="color: #000000">Graphics</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>

    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>windowCenter<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>windowCenter<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>font<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #000000">freeSurface</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>font<span style="color: #990000">)</span><span style="color: #990000">;</span>
        
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>stars<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> <span style="color: #990000">[</span><span style="color: #990000">]</span> stars<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #000000">destroySprites</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Initializes the graphics engine. Nothing must be drawn before this is</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * done. If this fails, you should quit.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @return true if successful. </span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">bool</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">init</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> resX<span style="color: #990000">,</span> <span style="color: #009900">int</span> resY<span style="color: #990000">,</span> <span style="color: #009900">int</span> bitDepth<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    screen <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">SDL_SetVideoMode</span></span><span style="color: #990000">(</span>resX<span style="color: #990000">,</span> resY<span style="color: #990000">,</span> bitDepth<span style="color: #990000">,</span> SDL_ANYFORMAT <span style="color: #990000">|</span> SDL_FULLSCREEN<span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Windowd mode:</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">//screen = SDL_SetVideoMode(resX, resY, bitDepth, SDL_ANYFORMAT);</span></span>
    
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="color: #990000">!</span>screen<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        cerr <span style="color: #990000">&lt;</span><span style="color: #990000">&lt;</span> <span style="color: #FF0000">"Failed to open screen: "</span> <span style="color: #990000">&lt;</span><span style="color: #990000">&lt;</span> <span style="font-weight: bold"><span style="color: #000000">SDL_GetError</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">&lt;</span><span style="color: #990000">&lt;</span> endl<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    
    <span style="font-weight: bold"><span style="color: #000000">SDL_WM_SetCaption</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"IPAG"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"IPAG"</span><span style="color: #990000">)</span><span style="color: #990000">;</span> 
    
    <span style="font-style: italic"><span style="color: #9A1900">//Load font</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>font <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">loadBitmap</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"data/font.bmp"</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Load all game graphics</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="color: #990000">!</span><span style="font-weight: bold"><span style="color: #000000">loadSprites</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Sets coordinate system so that grapchics becomes aware of the dimensions</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * of the world. This must be set before any game graphics is drawn.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">setCoordinateSystem</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> CoordinateSystem <span style="color: #990000">&amp;</span>system<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>windowCenter<span style="color: #990000">)</span><span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>windowCenter<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>windowCenter <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Coordinates</span></span><span style="color: #990000">(</span>system<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Converts screen coordinates to world coordinates.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
Coordinates <span style="color: #990000">*</span>Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">getWorldCoordinates</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> x<span style="color: #990000">,</span> <span style="color: #009900">int</span> y<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">float</span> wx<span style="color: #990000">,</span> wy<span style="color: #990000">;</span>
    Coordinates <span style="color: #990000">*</span>coords<span style="color: #990000">;</span>
    
    wx <span style="color: #990000">=</span> windowCenter<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getX</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">-</span> screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>w <span style="color: #990000">/</span> <span style="color: #993399">2</span> <span style="color: #990000">+</span> x<span style="color: #990000">;</span>
    wy <span style="color: #990000">=</span> windowCenter<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getY</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">-</span> screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>h <span style="color: #990000">/</span> <span style="color: #993399">2</span> <span style="color: #990000">+</span> y<span style="color: #990000">;</span>
    
    coords <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Coordinates</span></span><span style="color: #990000">(</span>windowCenter<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getCoordinateSystem</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">,</span> wx<span style="color: #990000">,</span> wy<span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> coords<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Updates screen so that user can see changes.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">update</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">SDL_UpdateRect</span></span><span style="color: #990000">(</span>screen<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Clears backbuffer.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">clear</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">lock</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>

    <span style="font-style: italic"><span style="color: #9A1900">//Paint it black</span></span>
    <span style="font-weight: bold"><span style="color: #000000">SDL_FillRect</span></span><span style="color: #990000">(</span>screen<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">SDL_MapRGB</span></span><span style="color: #990000">(</span>screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>format<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">)</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #000000">unlock</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Scrolls viewport by (x, y). Relative coordinates, world units.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">moveCamera</span></span><span style="color: #990000">(</span><span style="color: #009900">float</span> x<span style="color: #990000">,</span> <span style="color: #009900">float</span> y<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>windowCenter<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span>x<span style="color: #990000">,</span> y<span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Scroll starfield</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">//We cannot use the Coordinates / CoordinateSystem stuff here</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">//because of performance.</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>starfieldCenterX <span style="color: #990000">+</span><span style="color: #990000">=</span> x <span style="color: #990000">/</span> <span style="color: #993399">3</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>starfieldCenterY <span style="color: #990000">+</span><span style="color: #990000">=</span> y <span style="color: #990000">/</span> <span style="color: #993399">3</span><span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Make sure that coordinates stay within the acceptable region</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span>starfieldCenterX <span style="color: #990000">&lt;</span> <span style="color: #993399">0</span><span style="color: #990000">)</span>
        starfieldCenterX <span style="color: #990000">+</span><span style="color: #990000">=</span> screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>w<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span>starfieldCenterX <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>w<span style="color: #990000">)</span>
        starfieldCenterX <span style="color: #990000">-</span><span style="color: #990000">=</span> screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>w<span style="color: #990000">;</span>
        
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span>starfieldCenterY <span style="color: #990000">&lt;</span> <span style="color: #993399">0</span><span style="color: #990000">)</span>
        starfieldCenterY <span style="color: #990000">+</span><span style="color: #990000">=</span> screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>h<span style="color: #990000">;</span>
        
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span>starfieldCenterY <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>h<span style="color: #990000">)</span>
        starfieldCenterY <span style="color: #990000">-</span><span style="color: #990000">=</span> screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>h<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Moves camera so that point (x, y) is centerd. Absolute coordintes, world</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * units.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">setCamera</span></span><span style="color: #990000">(</span><span style="color: #009900">float</span> x<span style="color: #990000">,</span> <span style="color: #009900">float</span> y<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>windowCenter<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">set</span></span><span style="color: #990000">(</span>x<span style="color: #990000">,</span> y<span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Creates a random starfield. The field is stored in Graphics until a new</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * one is created.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">createStarfield</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">int</span> b<span style="color: #990000">;</span>  <span style="font-style: italic"><span style="color: #9A1900">//Brightness</span></span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Delete the old star field</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>stars<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> <span style="color: #990000">[</span><span style="color: #990000">]</span> stars<span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Create a new one</span></span>
    stars <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> TStar<span style="color: #990000">[</span>STARS<span style="color: #990000">]</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> i<span style="color: #990000">=</span><span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> STARS<span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        stars<span style="color: #990000">[</span>i<span style="color: #990000">]</span><span style="color: #990000">.</span>x <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">rand</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">%</span> screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>w<span style="color: #990000">;</span>
        stars<span style="color: #990000">[</span>i<span style="color: #990000">]</span><span style="color: #990000">.</span>y <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">rand</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">%</span> screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>h<span style="color: #990000">;</span>
        
        b <span style="color: #990000">=</span> <span style="color: #993399">32</span> <span style="color: #990000">+</span> <span style="font-weight: bold"><span style="color: #000000">rand</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span><span style="color: #993399">255</span> <span style="color: #990000">-</span> <span style="color: #993399">32</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        stars<span style="color: #990000">[</span>i<span style="color: #990000">]</span><span style="color: #990000">.</span>color <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">SDL_MapRGB</span></span><span style="color: #990000">(</span>screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>format<span style="color: #990000">,</span> b<span style="color: #990000">,</span> b<span style="color: #990000">,</span> b<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Draws the starfield directly on the screen.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">drawStarfield</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">int</span> sx<span style="color: #990000">,</span> sy<span style="color: #990000">;</span>  <span style="font-style: italic"><span style="color: #9A1900">//Screen coordinates</span></span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>stars <span style="color: #990000">=</span><span style="color: #990000">=</span> NULL<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> STARS<span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">//Scroll</span></span>
        sx <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="color: #990000">(</span>stars<span style="color: #990000">[</span>i<span style="color: #990000">]</span><span style="color: #990000">.</span>x <span style="color: #990000">-</span> starfieldCenterX<span style="color: #990000">)</span><span style="color: #990000">;</span>
        sy <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="color: #990000">(</span>stars<span style="color: #990000">[</span>i<span style="color: #990000">]</span><span style="color: #990000">.</span>y <span style="color: #990000">-</span> starfieldCenterY<span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Make sure that pixels stay in the window</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>sx <span style="color: #990000">&lt;</span> <span style="color: #993399">0</span><span style="color: #990000">)</span>
            sx <span style="color: #990000">+</span><span style="color: #990000">=</span> screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>w<span style="color: #990000">;</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>sy <span style="color: #990000">&lt;</span> <span style="color: #993399">0</span><span style="color: #990000">)</span>
            sy <span style="color: #990000">+</span><span style="color: #990000">=</span> screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>h<span style="color: #990000">;</span>
        
        <span style="font-weight: bold"><span style="color: #000000">putpixel</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>screen<span style="color: #990000">,</span> sx<span style="color: #990000">,</span> sy<span style="color: #990000">,</span> stars<span style="color: #990000">[</span>i<span style="color: #990000">]</span><span style="color: #990000">.</span>color<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>


<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Draws a bitmap on the screen. World coordinates.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param *surface Surface to be copied on the screen</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param &amp;location Location, world coordinates</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param *sourceRect Defines the area of the source bitmap that is to be</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> *                    copied. NULL means that whole bitmap is copied.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">drawBitmap</span></span><span style="color: #990000">(</span>SDL_Surface <span style="color: #990000">*</span>surface<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> Coordinates <span style="color: #990000">&amp;</span>location<span style="color: #990000">,</span>
                          SDL_Rect <span style="color: #990000">*</span>sourceRect<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">int</span> i<span style="color: #990000">,</span> j<span style="color: #990000">;</span>
    <span style="color: #009900">float</span> dx<span style="color: #990000">,</span> dy<span style="color: #990000">;</span>      <span style="font-style: italic"><span style="color: #9A1900">//Distance from window center</span></span>
    <span style="color: #009900">short</span> <span style="color: #009900">int</span> sx<span style="color: #990000">,</span> sy<span style="color: #990000">;</span>  <span style="font-style: italic"><span style="color: #9A1900">//Screen coordinates</span></span>
    <span style="color: #009900">unsigned</span> <span style="color: #009900">int</span> w<span style="color: #990000">,</span> h<span style="color: #990000">;</span>
    SDL_Rect destination<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>sourceRect <span style="color: #990000">=</span><span style="color: #990000">=</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        w <span style="color: #990000">=</span> surface<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>w<span style="color: #990000">;</span>
        h <span style="color: #990000">=</span> surface<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>h<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
        w <span style="color: #990000">=</span> sourceRect<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>w<span style="color: #990000">;</span>
        h <span style="color: #990000">=</span> sourceRect<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>h<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//We may have to draw it four times because of the continuous world.</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i<span style="color: #990000">=</span><span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">;</span> i<span style="color: #990000">&lt;</span><span style="color: #990000">=</span><span style="color: #993399">1</span><span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>j<span style="color: #990000">=</span><span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">;</span> j<span style="color: #990000">&lt;</span><span style="color: #990000">=</span><span style="color: #993399">1</span><span style="color: #990000">;</span> j<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-style: italic"><span style="color: #9A1900">//Bitmaps's distance from window center</span></span>
            dx <span style="color: #990000">=</span> windowCenter<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getDistanceX</span></span><span style="color: #990000">(</span>location<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getX</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">,</span> i<span style="color: #990000">)</span><span style="color: #990000">;</span>
            dy <span style="color: #990000">=</span> windowCenter<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getDistanceY</span></span><span style="color: #990000">(</span>location<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getY</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">,</span> j<span style="color: #990000">)</span><span style="color: #990000">;</span>
            
            <span style="font-style: italic"><span style="color: #9A1900">//Calculate screen coordinates</span></span>
            sx <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="color: #990000">(</span>screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>w <span style="color: #990000">/</span> <span style="color: #993399">2</span> <span style="color: #990000">+</span> dx <span style="color: #990000">-</span> w <span style="color: #990000">/</span> <span style="color: #993399">2</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            sy <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="color: #990000">(</span>screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>h <span style="color: #990000">/</span> <span style="color: #993399">2</span> <span style="color: #990000">+</span> dy <span style="color: #990000">-</span> h <span style="color: #990000">/</span> <span style="color: #993399">2</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            
            <span style="font-style: italic"><span style="color: #9A1900">//Draw if it's visible</span></span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="color: #990000">(</span>sx <span style="color: #990000">+</span> w <span style="color: #990000">&gt;</span> <span style="color: #993399">0</span><span style="color: #990000">)</span>  <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span>  <span style="color: #990000">(</span>sx <span style="color: #990000">&lt;</span> screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>w<span style="color: #990000">)</span>
                <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span>  <span style="color: #990000">(</span>sy <span style="color: #990000">+</span> h <span style="color: #990000">&gt;</span> <span style="color: #993399">0</span><span style="color: #990000">)</span>  <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span>  <span style="color: #990000">(</span>sy <span style="color: #990000">&lt;</span> screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>h<span style="color: #990000">)</span><span style="color: #990000">)</span>
            <span style="color: #FF0000">{</span>
                destination<span style="color: #990000">.</span>x <span style="color: #990000">=</span> sx<span style="color: #990000">;</span>
                destination<span style="color: #990000">.</span>y <span style="color: #990000">=</span> sy<span style="color: #990000">;</span>
                
                <span style="font-weight: bold"><span style="color: #000000">SDL_BlitSurface</span></span><span style="color: #990000">(</span>surface<span style="color: #990000">,</span> sourceRect<span style="color: #990000">,</span>
                                <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>screen<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>destination<span style="color: #990000">)</span><span style="color: #990000">;</span>
            <span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Draws a bitmap on the screen. Absolute screen coordinates.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param *surface Surface to be copied on the screen</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param x Location, screen coordinates</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param y Location, screen coordinates</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param *sourceRect Defines the area of the source bitmap that is to be</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> *                    copied. NULL means that whole bitmap is copied.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">drawBitmap</span></span><span style="color: #990000">(</span>SDL_Surface <span style="color: #990000">*</span>surface<span style="color: #990000">,</span> <span style="color: #009900">int</span> x<span style="color: #990000">,</span> <span style="color: #009900">int</span> y<span style="color: #990000">,</span>
                          SDL_Rect <span style="color: #990000">*</span>sourceRect<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    SDL_Rect destination<span style="color: #990000">;</span>
    destination<span style="color: #990000">.</span>x <span style="color: #990000">=</span> x<span style="color: #990000">;</span>
    destination<span style="color: #990000">.</span>y <span style="color: #990000">=</span> y<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #000000">SDL_BlitSurface</span></span><span style="color: #990000">(</span>surface<span style="color: #990000">,</span> sourceRect<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>screen<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>destination<span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Draws a sprite on the screen. World coordinates. For animated sprites you</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * should call drawAnimated().</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param &amp;location Location, world coordinates</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">drawSprite</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> spriteIndex<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> Coordinates <span style="color: #990000">&amp;</span>location<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>spriteIndex <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="color: #993399">0</span> <span style="color: #990000">|</span><span style="color: #990000">|</span> spriteIndex <span style="color: #990000">&lt;</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sprites<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #000000">drawBitmap</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sprites<span style="color: #990000">[</span>spriteIndex<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>surface<span style="color: #990000">,</span> location<span style="color: #990000">,</span> NULL<span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Draws a sprite on the screen. Absolute screen coordinates.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param x Location, screen coordinates</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param y Location, screen coordinates</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">drawSprite</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> spriteIndex<span style="color: #990000">,</span> <span style="color: #009900">int</span> x<span style="color: #990000">,</span> <span style="color: #009900">int</span> y<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>spriteIndex <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="color: #993399">0</span> <span style="color: #990000">|</span><span style="color: #990000">|</span> spriteIndex <span style="color: #990000">&lt;</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sprites<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #000000">drawBitmap</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sprites<span style="color: #990000">[</span>spriteIndex<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>surface<span style="color: #990000">,</span> x<span style="color: #990000">,</span> y<span style="color: #990000">,</span> NULL<span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Draws a sprite on the screen. Selects frame accoring to phase. 0 = first</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * frame, .999 = last frame, 1 = first frame again... Phase can be between</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * (0, inf). This if useful for loopable animations. For non-loopable</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * animations make sure not to ever reach 'phase = 1' because that's the</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * first frame again.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">drawAnimated</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> spriteIndex<span style="color: #990000">,</span>
                            <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> Coordinates <span style="color: #990000">&amp;</span>location<span style="color: #990000">,</span>
                            <span style="color: #009900">float</span> phase<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    SDL_Rect sourceRect<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>spriteIndex <span style="color: #990000">&lt;</span> <span style="color: #993399">0</span> <span style="color: #990000">|</span><span style="color: #990000">|</span> spriteIndex <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sprites<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    
    <span style="color: #009900">int</span> cols <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sprites<span style="color: #990000">[</span>spriteIndex<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>columns<span style="color: #990000">;</span>
    <span style="color: #009900">int</span> rows <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sprites<span style="color: #990000">[</span>spriteIndex<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>rows<span style="color: #990000">;</span>
    <span style="color: #009900">int</span> w <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sprites<span style="color: #990000">[</span>spriteIndex<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>surface<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>w<span style="color: #990000">;</span>
    <span style="color: #009900">int</span> h <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sprites<span style="color: #990000">[</span>spriteIndex<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>surface<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>h<span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Loop it</span></span>
    <span style="color: #009900">int</span> frame <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="color: #990000">(</span>phase <span style="color: #990000">*</span> cols <span style="color: #990000">*</span> rows<span style="color: #990000">)</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span>rows <span style="color: #990000">*</span> cols<span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Calculate source region</span></span>
    sourceRect<span style="color: #990000">.</span>x <span style="color: #990000">=</span> <span style="color: #990000">(</span>frame <span style="color: #990000">%</span> cols<span style="color: #990000">)</span> <span style="color: #990000">*</span> <span style="color: #990000">(</span>w <span style="color: #990000">/</span> cols<span style="color: #990000">)</span><span style="color: #990000">;</span>
    sourceRect<span style="color: #990000">.</span>y <span style="color: #990000">=</span> <span style="color: #990000">(</span>frame <span style="color: #990000">/</span> cols<span style="color: #990000">)</span> <span style="color: #990000">*</span> <span style="color: #990000">(</span>h <span style="color: #990000">/</span> rows<span style="color: #990000">)</span><span style="color: #990000">;</span>
    sourceRect<span style="color: #990000">.</span>w <span style="color: #990000">=</span> w <span style="color: #990000">/</span> cols<span style="color: #990000">;</span>
    sourceRect<span style="color: #990000">.</span>h <span style="color: #990000">=</span> h <span style="color: #990000">/</span> rows<span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #000000">drawBitmap</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sprites<span style="color: #990000">[</span>spriteIndex<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>surface<span style="color: #990000">,</span> location<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>sourceRect<span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Rotates a bitmap and draws the result on a surface. Note that this is a</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * rather slow operation.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param *source Bitmap to be rotated.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param *target Surface that the result is drawn to</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param rot Angle in radians, 0 = east, ccw</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">drawRotated</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> SDL_Surface <span style="color: #990000">*</span>source<span style="color: #990000">,</span> SDL_Surface <span style="color: #990000">*</span>target<span style="color: #990000">,</span>
                           <span style="color: #009900">float</span> rot<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="color: #009900">double</span> x<span style="color: #990000">,</span> y<span style="color: #990000">;</span>       <span style="font-style: italic"><span style="color: #9A1900">//Auxiliary</span></span>
    <span style="color: #009900">float</span> angle<span style="color: #990000">,</span> dist<span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">//Pixel's angle and distance from the center</span></span>
    <span style="color: #009900">int</span> sx<span style="color: #990000">,</span> sy<span style="color: #990000">;</span>        <span style="font-style: italic"><span style="color: #9A1900">//Source coordinates</span></span>
    <span style="color: #009900">int</span> tx<span style="color: #990000">,</span> ty<span style="color: #990000">;</span>        <span style="font-style: italic"><span style="color: #9A1900">//Target coordinates</span></span>
    Uint32 color<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>ty <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> ty <span style="color: #990000">&lt;</span> target<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>h<span style="color: #990000">;</span> ty<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>tx <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> tx <span style="color: #990000">&lt;</span> target<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>w<span style="color: #990000">;</span> tx<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-style: italic"><span style="color: #9A1900">//Read a pixel from rotated coordinates and plot</span></span>
            
            x <span style="color: #990000">=</span> tx <span style="color: #990000">-</span> source<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>w <span style="color: #990000">/</span> <span style="color: #993399">2</span><span style="color: #990000">;</span>
            y <span style="color: #990000">=</span> ty <span style="color: #990000">-</span> source<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>h <span style="color: #990000">/</span> <span style="color: #993399">2</span><span style="color: #990000">;</span>
            angle <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">atan2</span></span><span style="color: #990000">(</span>y<span style="color: #990000">,</span> x<span style="color: #990000">)</span><span style="color: #990000">;</span>
            dist <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">sqrt</span></span><span style="color: #990000">(</span>x<span style="color: #990000">*</span>x <span style="color: #990000">+</span> y<span style="color: #990000">*</span>y<span style="color: #990000">)</span><span style="color: #990000">;</span>
            
            angle <span style="color: #990000">-</span><span style="color: #990000">=</span> rot<span style="color: #990000">;</span>
            sx <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">cos</span></span><span style="color: #990000">(</span>angle<span style="color: #990000">)</span> <span style="color: #990000">*</span> dist <span style="color: #990000">+</span> source<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>w <span style="color: #990000">/</span> <span style="color: #993399">2</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            sy <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">sin</span></span><span style="color: #990000">(</span>angle<span style="color: #990000">)</span> <span style="color: #990000">*</span> dist <span style="color: #990000">+</span> source<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>h <span style="color: #990000">/</span> <span style="color: #993399">2</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>sx <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="color: #993399">0</span> <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span> sx <span style="color: #990000">&lt;</span> source<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>w <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span> sy <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="color: #993399">0</span> <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span> sy <span style="color: #990000">&lt;</span> source<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>h<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                color <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">getpixel</span></span><span style="color: #990000">(</span>source<span style="color: #990000">,</span> sx<span style="color: #990000">,</span> sy<span style="color: #990000">)</span><span style="color: #990000">;</span>
                <span style="font-weight: bold"><span style="color: #000000">putpixel</span></span><span style="color: #990000">(</span>target<span style="color: #990000">,</span> tx<span style="color: #990000">,</span> ty<span style="color: #990000">,</span> color<span style="color: #990000">)</span><span style="color: #990000">;</span>
            <span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Draws a filled rectangle on screen. World coordinates.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param &amp;location Location of the top-left corner</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param w Width in world units</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param h Height in world units</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">drawRect</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> Coordinates <span style="color: #990000">&amp;</span>location<span style="color: #990000">,</span>
                        <span style="color: #009900">unsigned</span> <span style="color: #009900">int</span> w<span style="color: #990000">,</span> <span style="color: #009900">unsigned</span> <span style="color: #009900">int</span> h<span style="color: #990000">,</span>
                        Uint8 r<span style="color: #990000">,</span> Uint8 g<span style="color: #990000">,</span> Uint8 b<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="color: #009900">int</span> i<span style="color: #990000">,</span> j<span style="color: #990000">;</span>
    SDL_Rect destination<span style="color: #990000">;</span>
    <span style="color: #009900">float</span> dx<span style="color: #990000">,</span> dy<span style="color: #990000">;</span>         <span style="font-style: italic"><span style="color: #9A1900">//Distance from window center</span></span>
    <span style="color: #009900">int</span> sx<span style="color: #990000">,</span> sy<span style="color: #990000">;</span>           <span style="font-style: italic"><span style="color: #9A1900">//Screen coordinates</span></span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Draw it in four places</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i<span style="color: #990000">=</span><span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">;</span> i<span style="color: #990000">&lt;</span><span style="color: #990000">=</span><span style="color: #993399">1</span><span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>j<span style="color: #990000">=</span><span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">;</span> j<span style="color: #990000">&lt;</span><span style="color: #990000">=</span><span style="color: #993399">1</span><span style="color: #990000">;</span> j<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            destination<span style="color: #990000">.</span>w <span style="color: #990000">=</span> <span style="color: #990000">(</span>Uint16<span style="color: #990000">)</span>w<span style="color: #990000">;</span>
            destination<span style="color: #990000">.</span>h <span style="color: #990000">=</span> <span style="color: #990000">(</span>Uint16<span style="color: #990000">)</span>h<span style="color: #990000">;</span>
            
            <span style="font-style: italic"><span style="color: #9A1900">//Object's distance from window center</span></span>
            dx <span style="color: #990000">=</span> windowCenter<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getDistanceX</span></span><span style="color: #990000">(</span>location<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getX</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">,</span> i<span style="color: #990000">)</span><span style="color: #990000">;</span>
            dy <span style="color: #990000">=</span> windowCenter<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getDistanceY</span></span><span style="color: #990000">(</span>location<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getY</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">,</span> j<span style="color: #990000">)</span><span style="color: #990000">;</span>
            
            <span style="font-style: italic"><span style="color: #9A1900">//Calculate screen coordinates</span></span>
            sx <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="color: #990000">(</span>screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>w <span style="color: #990000">/</span> <span style="color: #993399">2</span> <span style="color: #990000">+</span> dx <span style="color: #990000">-</span> w <span style="color: #990000">/</span> <span style="color: #993399">2</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            sy <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="color: #990000">(</span>screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>h <span style="color: #990000">/</span> <span style="color: #993399">2</span> <span style="color: #990000">+</span> dy <span style="color: #990000">-</span> h <span style="color: #990000">/</span> <span style="color: #993399">2</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            
            <span style="font-style: italic"><span style="color: #9A1900">//Draw if it's visible</span></span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="color: #990000">(</span>sx <span style="color: #990000">+</span> w <span style="color: #990000">&gt;</span> <span style="color: #993399">0</span><span style="color: #990000">)</span>  <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span>  <span style="color: #990000">(</span>sx <span style="color: #990000">&lt;</span> screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>w<span style="color: #990000">)</span>
                <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span>  <span style="color: #990000">(</span>sy <span style="color: #990000">+</span> h <span style="color: #990000">&gt;</span> <span style="color: #993399">0</span><span style="color: #990000">)</span>  <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span>  <span style="color: #990000">(</span>sy <span style="color: #990000">&lt;</span> screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>h<span style="color: #990000">)</span><span style="color: #990000">)</span>
            <span style="color: #FF0000">{</span>
                destination<span style="color: #990000">.</span>x <span style="color: #990000">=</span> sx<span style="color: #990000">;</span>
                destination<span style="color: #990000">.</span>y <span style="color: #990000">=</span> sy<span style="color: #990000">;</span>
                
                <span style="font-weight: bold"><span style="color: #000000">SDL_FillRect</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>screen<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>destination<span style="color: #990000">,</span>
                             <span style="font-weight: bold"><span style="color: #000000">SDL_MapRGB</span></span><span style="color: #990000">(</span>screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>format<span style="color: #990000">,</span> r<span style="color: #990000">,</span> g<span style="color: #990000">,</span> b<span style="color: #990000">)</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            <span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Draws a filled rectangle on the screen. Screen units.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param *target Target surface, NULL means screen</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param x Location of the top-left corner</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param y Location of the top-left corner</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param w Width in pixels</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param h Height in pixels</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">drawRect</span></span><span style="color: #990000">(</span>SDL_Surface <span style="color: #990000">*</span>target<span style="color: #990000">,</span> <span style="color: #009900">int</span> x<span style="color: #990000">,</span> <span style="color: #009900">int</span> y<span style="color: #990000">,</span>
                        <span style="color: #009900">unsigned</span> <span style="color: #009900">int</span> w<span style="color: #990000">,</span> <span style="color: #009900">unsigned</span> <span style="color: #009900">int</span> h<span style="color: #990000">,</span>
                        Uint8 r<span style="color: #990000">,</span> Uint8 g<span style="color: #990000">,</span> Uint8 b<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    SDL_Rect destination<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>target <span style="color: #990000">=</span><span style="color: #990000">=</span> NULL<span style="color: #990000">)</span>
        target <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>screen<span style="color: #990000">;</span>
    
    destination<span style="color: #990000">.</span>x <span style="color: #990000">=</span> x<span style="color: #990000">;</span>
    destination<span style="color: #990000">.</span>y <span style="color: #990000">=</span> y<span style="color: #990000">;</span>
    destination<span style="color: #990000">.</span>w <span style="color: #990000">=</span> <span style="color: #990000">(</span>Uint16<span style="color: #990000">)</span>w<span style="color: #990000">;</span>
    destination<span style="color: #990000">.</span>h <span style="color: #990000">=</span> <span style="color: #990000">(</span>Uint16<span style="color: #990000">)</span>h<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #000000">SDL_FillRect</span></span><span style="color: #990000">(</span>target<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>destination<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">SDL_MapRGB</span></span><span style="color: #990000">(</span>target<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>format<span style="color: #990000">,</span> r<span style="color: #990000">,</span> g<span style="color: #990000">,</span> b<span style="color: #990000">)</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Draws text on a surface.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param *target Target surface. If NULL, the text is rendered directly on</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * the screen.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">drawText</span></span><span style="color: #990000">(</span>SDL_Surface <span style="color: #990000">*</span>target<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>text<span style="color: #990000">,</span> <span style="color: #009900">int</span> x<span style="color: #990000">,</span> <span style="color: #009900">int</span> y<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    SDL_Rect source<span style="color: #990000">,</span> destination<span style="color: #990000">;</span>
    
    source<span style="color: #990000">.</span>w <span style="color: #990000">=</span> <span style="color: #993399">8</span><span style="color: #990000">;</span>
    source<span style="color: #990000">.</span>h <span style="color: #990000">=</span> <span style="color: #993399">14</span><span style="color: #990000">;</span>
    destination<span style="color: #990000">.</span>x <span style="color: #990000">=</span> x<span style="color: #990000">;</span>
    destination<span style="color: #990000">.</span>y <span style="color: #990000">=</span> y<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>target <span style="color: #990000">=</span><span style="color: #990000">=</span> NULL<span style="color: #990000">)</span>
        target <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>screen<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">unsigned</span> <span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> <span style="font-weight: bold"><span style="color: #000000">strlen</span></span><span style="color: #990000">(</span>text<span style="color: #990000">)</span><span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>text<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="color: #FF0000">'A'</span> <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span> text<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">&lt;</span><span style="color: #990000">=</span> <span style="color: #FF0000">'Z'</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            source<span style="color: #990000">.</span>x <span style="color: #990000">=</span> <span style="color: #990000">(</span>text<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">-</span> <span style="color: #FF0000">'A'</span><span style="color: #990000">)</span> <span style="color: #990000">*</span> <span style="color: #993399">8</span><span style="color: #990000">;</span>
            source<span style="color: #990000">.</span>y <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>text<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="color: #FF0000">'a'</span> <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span> text<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">&lt;</span><span style="color: #990000">=</span> <span style="color: #FF0000">'z'</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            source<span style="color: #990000">.</span>x <span style="color: #990000">=</span> <span style="color: #990000">(</span>text<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">-</span> <span style="color: #FF0000">'a'</span><span style="color: #990000">)</span> <span style="color: #990000">*</span> <span style="color: #993399">8</span><span style="color: #990000">;</span>
            source<span style="color: #990000">.</span>y <span style="color: #990000">=</span> <span style="color: #993399">14</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>text<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="color: #FF0000">'0'</span> <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span> text<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">&lt;</span><span style="color: #990000">=</span> <span style="color: #FF0000">'9'</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            source<span style="color: #990000">.</span>x <span style="color: #990000">=</span> <span style="color: #990000">(</span>text<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">-</span> <span style="color: #FF0000">'0'</span><span style="color: #990000">)</span> <span style="color: #990000">*</span> <span style="color: #993399">8</span><span style="color: #990000">;</span>
            source<span style="color: #990000">.</span>y <span style="color: #990000">=</span> <span style="color: #993399">28</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>text<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">=</span><span style="color: #990000">=</span> <span style="color: #FF0000">'\n'</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            source<span style="color: #990000">.</span>x <span style="color: #990000">=</span> <span style="color: #993399">112</span><span style="color: #990000">;</span>
            source<span style="color: #990000">.</span>y <span style="color: #990000">=</span> <span style="color: #993399">28</span><span style="color: #990000">;</span>
            destination<span style="color: #990000">.</span>x <span style="color: #990000">=</span> x<span style="color: #990000">;</span>
            destination<span style="color: #990000">.</span>y <span style="color: #990000">+</span><span style="color: #990000">=</span> LINE_HEIGHT<span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">continue</span></span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>text<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="color: #FF0000">'$'</span> <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span> text<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">&lt;</span><span style="color: #990000">=</span> <span style="color: #FF0000">'/'</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            source<span style="color: #990000">.</span>x <span style="color: #990000">=</span> <span style="color: #990000">(</span>text<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">-</span> <span style="color: #FF0000">'$'</span><span style="color: #990000">)</span> <span style="color: #990000">*</span> <span style="color: #993399">8</span><span style="color: #990000">;</span>
            source<span style="color: #990000">.</span>y <span style="color: #990000">=</span> <span style="color: #993399">42</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>text<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="color: #FF0000">':'</span> <span style="color: #990000">&amp;</span><span style="color: #990000">&amp;</span> text<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">&lt;</span><span style="color: #990000">=</span> <span style="color: #FF0000">'?'</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            source<span style="color: #990000">.</span>x <span style="color: #990000">=</span> <span style="color: #990000">(</span>text<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">-</span> <span style="color: #FF0000">':'</span><span style="color: #990000">)</span> <span style="color: #990000">*</span> <span style="color: #993399">8</span> <span style="color: #990000">+</span> <span style="color: #993399">96</span><span style="color: #990000">;</span>
            source<span style="color: #990000">.</span>y <span style="color: #990000">=</span> <span style="color: #993399">42</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
            <span style="font-style: italic"><span style="color: #9A1900">//Unknown character or empty space</span></span>
            source<span style="color: #990000">.</span>x <span style="color: #990000">=</span> <span style="color: #993399">88</span><span style="color: #990000">;</span>
            source<span style="color: #990000">.</span>y <span style="color: #990000">=</span> <span style="color: #993399">28</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        
        <span style="font-weight: bold"><span style="color: #000000">SDL_BlitSurface</span></span><span style="color: #990000">(</span>font<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>source<span style="color: #990000">,</span> target<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>destination<span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        destination<span style="color: #990000">.</span>x <span style="color: #990000">+</span><span style="color: #990000">=</span> CHAR_WIDTH<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">getLineHeight</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> LINE_HEIGHT<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">getCharWidth</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> CHAR_WIDTH<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Returns the sdl-surface of a sprite. Note that many objects may use</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * the same sprite and sprites may not be modified.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @return NULL if there is no such sprite</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">const</span></span> SDL_Surface<span style="color: #990000">*</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">getSurface</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> spriteIndex<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>spriteIndex <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="color: #993399">0</span> <span style="color: #990000">|</span><span style="color: #990000">|</span> spriteIndex <span style="color: #990000">&lt;</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sprites<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sprites<span style="color: #990000">[</span>spriteIndex<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>surface<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> NULL<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Returns a sprite index. This index can be used later to access the</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * sprite.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param *name Name of the sprite. Names are defined in resource file</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> *              'data/bitmaps'.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @return sprite index, or -1 if there is no such sprite</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">int</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">getSpriteIndex</span></span><span style="color: #990000">(</span><span style="color: #009900">char</span> <span style="color: #990000">*</span>name<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-style: italic"><span style="color: #9A1900">//Find the sprite</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sprites<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">strcmp</span></span><span style="color: #990000">(</span>name<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sprites<span style="color: #990000">[</span>i<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>name<span style="color: #990000">)</span> <span style="color: #990000">=</span><span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">)</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> i<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Loads a bitmap and returns a pointer to the sdl-surface. Remember to free</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * it.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @return NULL on failure</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
SDL_Surface<span style="color: #990000">*</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">loadBitmap</span></span><span style="color: #990000">(</span><span style="color: #009900">char</span> <span style="color: #990000">*</span>fileName<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    SDL_Surface<span style="color: #990000">*</span> tempBitmap<span style="color: #990000">;</span>
    SDL_Surface<span style="color: #990000">*</span> finalBitmap<span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Load the bitmap</span></span>
    tempBitmap <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">SDL_LoadBMP</span></span><span style="color: #990000">(</span>fileName<span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>tempBitmap <span style="color: #990000">=</span><span style="color: #990000">=</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        cerr <span style="color: #990000">&lt;</span><span style="color: #990000">&lt;</span> <span style="color: #FF0000">"Failed to load bitmap: "</span> <span style="color: #990000">&lt;</span><span style="color: #990000">&lt;</span> <span style="font-weight: bold"><span style="color: #000000">SDL_GetError</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">&lt;</span><span style="color: #990000">&lt;</span> endl<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> NULL<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Set transparency</span></span>
    <span style="font-weight: bold"><span style="color: #000000">SDL_SetColorKey</span></span><span style="color: #990000">(</span>tempBitmap<span style="color: #990000">,</span> SDL_SRCCOLORKEY <span style="color: #990000">|</span> SDL_RLEACCEL<span style="color: #990000">,</span>
                    <span style="font-weight: bold"><span style="color: #000000">SDL_MapRGB</span></span><span style="color: #990000">(</span>tempBitmap<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>format<span style="color: #990000">,</span> <span style="color: #993399">255</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">255</span><span style="color: #990000">)</span><span style="color: #990000">)</span><span style="color: #990000">;</span> 
    
    <span style="font-style: italic"><span style="color: #9A1900">//Convert colors to speed up blitting</span></span>
    finalBitmap <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">SDL_DisplayFormat</span></span><span style="color: #990000">(</span>tempBitmap<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>finalBitmap <span style="color: #990000">=</span><span style="color: #990000">=</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">SDL_FreeSurface</span></span><span style="color: #990000">(</span>tempBitmap<span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> NULL<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Free the temporary bitmap</span></span>
    <span style="font-weight: bold"><span style="color: #000000">SDL_FreeSurface</span></span><span style="color: #990000">(</span>tempBitmap<span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> finalBitmap<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Loads common game graphics. This should only be called once at init.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @return true on success, false on failure</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">bool</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">loadSprites</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    TSprite <span style="color: #990000">*</span>sprite<span style="color: #990000">;</span>

    ifstream file<span style="color: #990000">;</span>
    <span style="color: #009900">char</span> line<span style="color: #990000">[</span><span style="color: #993399">128</span><span style="color: #990000">]</span><span style="color: #990000">;</span>
    <span style="color: #009900">int</span> rows<span style="color: #990000">,</span> columns<span style="color: #990000">;</span>
    
    file<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">open</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"data/bitmaps"</span><span style="color: #990000">,</span> ifstream<span style="color: #990000">:</span><span style="color: #990000">:</span>in<span style="color: #990000">)</span><span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="color: #990000">!</span>file<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">is_open</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        cerr <span style="color: #990000">&lt;</span><span style="color: #990000">&lt;</span> <span style="color: #FF0000">"Failed to open data/bitmaps"</span> <span style="color: #990000">&lt;</span><span style="color: #990000">&lt;</span> endl<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span>file<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">good</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        file<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getline</span></span><span style="color: #990000">(</span>line<span style="color: #990000">,</span> <span style="color: #993399">128</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Skip empty lines</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">strlen</span></span><span style="color: #990000">(</span>line<span style="color: #990000">)</span> <span style="color: #990000">&lt;</span> <span style="color: #993399">1</span><span style="color: #990000">)</span>
            <span style="font-weight: bold"><span style="color: #0000FF">continue</span></span><span style="color: #990000">;</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Create a new sprite</span></span>
        sprite <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> TSprite<span style="color: #990000">;</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Name</span></span>
        sprite<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>name <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="color: #009900">char</span><span style="color: #990000">[</span><span style="font-weight: bold"><span style="color: #000000">strlen</span></span><span style="color: #990000">(</span>line<span style="color: #990000">)</span> <span style="color: #990000">+</span> <span style="color: #993399">1</span><span style="color: #990000">]</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">strcpy</span></span><span style="color: #990000">(</span>sprite<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>name<span style="color: #990000">,</span> line<span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//File name</span></span>
        file<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getline</span></span><span style="color: #990000">(</span>line<span style="color: #990000">,</span> <span style="color: #993399">128</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        sprite<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>surface <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">loadBitmap</span></span><span style="color: #990000">(</span>line<span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>sprite<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>surface <span style="color: #990000">=</span><span style="color: #990000">=</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            file<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>

        <span style="font-style: italic"><span style="color: #9A1900">//Columns</span></span>
        file<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getline</span></span><span style="color: #990000">(</span>line<span style="color: #990000">,</span> <span style="color: #993399">128</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">sscanf</span></span><span style="color: #990000">(</span>line<span style="color: #990000">,</span> <span style="color: #FF0000">"%*s %i"</span><span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>columns<span style="color: #990000">)</span> <span style="color: #990000">!</span><span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            cerr <span style="color: #990000">&lt;</span><span style="color: #990000">&lt;</span> <span style="color: #FF0000">"Resource file 'bitmaps' is corrupt"</span> <span style="color: #990000">&lt;</span><span style="color: #990000">&lt;</span> endl<span style="color: #990000">;</span>
            file<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        sprite<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>columns <span style="color: #990000">=</span> columns<span style="color: #990000">;</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Rows</span></span>
        file<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getline</span></span><span style="color: #990000">(</span>line<span style="color: #990000">,</span> <span style="color: #993399">128</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">sscanf</span></span><span style="color: #990000">(</span>line<span style="color: #990000">,</span> <span style="color: #FF0000">"%*s %i"</span><span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>rows<span style="color: #990000">)</span> <span style="color: #990000">!</span><span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            cerr <span style="color: #990000">&lt;</span><span style="color: #990000">&lt;</span> <span style="color: #FF0000">"Resource file 'bitmaps' is corrupt"</span> <span style="color: #990000">&lt;</span><span style="color: #990000">&lt;</span> endl<span style="color: #990000">;</span>
            file<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        sprite<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>rows <span style="color: #990000">=</span> rows<span style="color: #990000">;</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Color key</span></span>
        file<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getline</span></span><span style="color: #990000">(</span>line<span style="color: #990000">,</span> <span style="color: #993399">128</span><span style="color: #990000">)</span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">//This parameter cannot be adjusted yet</span></span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Use the default color key</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>sprite<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>surface <span style="color: #990000">!</span><span style="color: #990000">=</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">SDL_SetColorKey</span></span><span style="color: #990000">(</span>sprite<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>surface<span style="color: #990000">,</span> SDL_SRCCOLORKEY <span style="color: #990000">|</span> SDL_RLEACCEL<span style="color: #990000">,</span>
                            <span style="font-weight: bold"><span style="color: #000000">SDL_MapRGB</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>screen<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>format<span style="color: #990000">,</span> <span style="color: #993399">255</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">255</span><span style="color: #990000">)</span><span style="color: #990000">)</span><span style="color: #990000">;</span> 
        <span style="color: #FF0000">}</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sprites<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">push_back</span></span><span style="color: #990000">(</span>sprite<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>

    file<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Destroys game graphics</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">destroySprites</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sprites<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span> i<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> <span style="color: #990000">[</span><span style="color: #990000">]</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sprites<span style="color: #990000">[</span>i<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>name<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">SDL_FreeSurface</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sprites<span style="color: #990000">[</span>i<span style="color: #990000">]</span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>surface<span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">delete</span></span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sprites<span style="color: #990000">[</span>i<span style="color: #990000">]</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>sprites<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">clear</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Creates a unique surface that can be used to store any image data. The</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * surface must be freed when it's not needed anymore.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param w width in pixels</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param h height in pixels</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
SDL_Surface <span style="color: #990000">*</span>Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">createSurface</span></span><span style="color: #990000">(</span><span style="color: #009900">unsigned</span> <span style="color: #009900">int</span> w<span style="color: #990000">,</span> <span style="color: #009900">unsigned</span> <span style="color: #009900">int</span> h<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    SDL_Surface <span style="color: #990000">*</span>tempBitmap<span style="color: #990000">;</span>
    SDL_Surface <span style="color: #990000">*</span>finalBitmap<span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Create a new surface</span></span>
    tempBitmap <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">SDL_CreateRGBSurface</span></span><span style="color: #990000">(</span>SDL_SWSURFACE<span style="color: #990000">,</span> w<span style="color: #990000">,</span> h<span style="color: #990000">,</span> <span style="color: #993399">32</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">)</span><span style="color: #990000">;</span>

    <span style="font-style: italic"><span style="color: #9A1900">//Set transparency</span></span>
    <span style="font-weight: bold"><span style="color: #000000">SDL_SetColorKey</span></span><span style="color: #990000">(</span>tempBitmap<span style="color: #990000">,</span> SDL_SRCCOLORKEY <span style="color: #990000">|</span> SDL_RLEACCEL<span style="color: #990000">,</span>
                    <span style="font-weight: bold"><span style="color: #000000">SDL_MapRGB</span></span><span style="color: #990000">(</span>tempBitmap<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>format<span style="color: #990000">,</span> <span style="color: #993399">255</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">255</span><span style="color: #990000">)</span><span style="color: #990000">)</span><span style="color: #990000">;</span> 
    
    <span style="font-style: italic"><span style="color: #9A1900">//Convert colors to speed up blitting</span></span>
    finalBitmap <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">SDL_DisplayFormat</span></span><span style="color: #990000">(</span>tempBitmap<span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #000000">SDL_FreeSurface</span></span><span style="color: #990000">(</span>tempBitmap<span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>finalBitmap <span style="color: #990000">=</span><span style="color: #990000">=</span> NULL<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> NULL<span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//Paint it transparent initially</span></span>
    <span style="font-weight: bold"><span style="color: #000000">SDL_FillRect</span></span><span style="color: #990000">(</span>finalBitmap<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span>
                 <span style="font-weight: bold"><span style="color: #000000">SDL_MapRGB</span></span><span style="color: #990000">(</span>finalBitmap<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>format<span style="color: #990000">,</span> <span style="color: #993399">255</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">255</span><span style="color: #990000">)</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> finalBitmap<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Frees a surface that was created with createSurface().</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">freeSurface</span></span><span style="color: #990000">(</span>SDL_Surface <span style="color: #990000">*</span>surface<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">SDL_FreeSurface</span></span><span style="color: #990000">(</span>surface<span style="color: #990000">)</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Plots a pixel directly to a surface. Screen coordinates.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">putpixel</span></span><span style="color: #990000">(</span>SDL_Surface <span style="color: #990000">*</span>surface<span style="color: #990000">,</span> <span style="color: #009900">int</span> x<span style="color: #990000">,</span> <span style="color: #009900">int</span> y<span style="color: #990000">,</span> Uint32 color<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-style: italic"><span style="color: #9A1900">/* This code is from SDL documentation. */</span></span>
    
    <span style="color: #009900">int</span> bpp <span style="color: #990000">=</span> surface<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>format<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>BytesPerPixel<span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">//p is the address to the pixel</span></span>
    Uint8 <span style="color: #990000">*</span>p <span style="color: #990000">=</span> <span style="color: #990000">(</span>Uint8 <span style="color: #990000">*</span><span style="color: #990000">)</span>surface<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>pixels <span style="color: #990000">+</span> y <span style="color: #990000">*</span> surface<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>pitch <span style="color: #990000">+</span> x <span style="color: #990000">*</span> bpp<span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #0000FF">switch</span></span><span style="color: #990000">(</span>bpp<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #993399">1</span><span style="color: #990000">:</span>
            <span style="color: #990000">*</span>p <span style="color: #990000">=</span> color<span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #993399">2</span><span style="color: #990000">:</span>
            <span style="color: #990000">*</span><span style="color: #990000">(</span>Uint16 <span style="color: #990000">*</span><span style="color: #990000">)</span>p <span style="color: #990000">=</span> color<span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #993399">3</span><span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span><span style="color: #990000">(</span>SDL_BYTEORDER <span style="color: #990000">=</span><span style="color: #990000">=</span> SDL_BIG_ENDIAN<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                p<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #990000">(</span>color <span style="color: #990000">&gt;</span><span style="color: #990000">&gt;</span> <span style="color: #993399">16</span><span style="color: #990000">)</span> <span style="color: #990000">&amp;</span> <span style="color: #993399">0xff</span><span style="color: #990000">;</span>
                p<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #990000">(</span>color <span style="color: #990000">&gt;</span><span style="color: #990000">&gt;</span> <span style="color: #993399">8</span><span style="color: #990000">)</span> <span style="color: #990000">&amp;</span> <span style="color: #993399">0xff</span><span style="color: #990000">;</span>
                p<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> color <span style="color: #990000">&amp;</span> <span style="color: #993399">0xff</span><span style="color: #990000">;</span>
            <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
                p<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> color <span style="color: #990000">&amp;</span> <span style="color: #993399">0xff</span><span style="color: #990000">;</span>
                p<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #990000">(</span>color <span style="color: #990000">&gt;</span><span style="color: #990000">&gt;</span> <span style="color: #993399">8</span><span style="color: #990000">)</span> <span style="color: #990000">&amp;</span> <span style="color: #993399">0xff</span><span style="color: #990000">;</span>
                p<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #990000">(</span>color <span style="color: #990000">&gt;</span><span style="color: #990000">&gt;</span> <span style="color: #993399">16</span><span style="color: #990000">)</span> <span style="color: #990000">&amp;</span> <span style="color: #993399">0xff</span><span style="color: #990000">;</span>
            <span style="color: #FF0000">}</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
        
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #993399">4</span><span style="color: #990000">:</span>
            <span style="color: #990000">*</span><span style="color: #990000">(</span>Uint32 <span style="color: #990000">*</span><span style="color: #990000">)</span>p <span style="color: #990000">=</span> color<span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Returns the pixel value at (x, y). Screen coordinates.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
Uint32 Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">getpixel</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> SDL_Surface <span style="color: #990000">*</span>surface<span style="color: #990000">,</span> <span style="color: #009900">int</span> x<span style="color: #990000">,</span> <span style="color: #009900">int</span> y<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-style: italic"><span style="color: #9A1900">/* This code is from SDL documentation. */</span></span>
    
    <span style="color: #009900">int</span> bpp <span style="color: #990000">=</span> surface<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>format<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>BytesPerPixel<span style="color: #990000">;</span>
    
    <span style="font-style: italic"><span style="color: #9A1900">// p is the address to the pixel</span></span>
    Uint8 <span style="color: #990000">*</span>p <span style="color: #990000">=</span> <span style="color: #990000">(</span>Uint8 <span style="color: #990000">*</span><span style="color: #990000">)</span>surface<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>pixels <span style="color: #990000">+</span> y <span style="color: #990000">*</span> surface<span style="color: #990000">-</span><span style="color: #990000">&gt;</span>pitch <span style="color: #990000">+</span> x <span style="color: #990000">*</span> bpp<span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #0000FF">switch</span></span><span style="color: #990000">(</span>bpp<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #993399">1</span><span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #990000">*</span>p<span style="color: #990000">;</span>
    
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #993399">2</span><span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #990000">*</span><span style="color: #990000">(</span>Uint16 <span style="color: #990000">*</span><span style="color: #990000">)</span>p<span style="color: #990000">;</span>
    
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #993399">3</span><span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span><span style="color: #990000">(</span>SDL_BYTEORDER <span style="color: #990000">=</span><span style="color: #990000">=</span> SDL_BIG_ENDIAN<span style="color: #990000">)</span>
                <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> p<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]</span> <span style="color: #990000">&lt;</span><span style="color: #990000">&lt;</span> <span style="color: #993399">16</span> <span style="color: #990000">|</span> p<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]</span> <span style="color: #990000">&lt;</span><span style="color: #990000">&lt;</span> <span style="color: #993399">8</span> <span style="color: #990000">|</span> p<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">]</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> p<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]</span> <span style="color: #990000">|</span> p<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]</span> <span style="color: #990000">&lt;</span><span style="color: #990000">&lt;</span> <span style="color: #993399">8</span> <span style="color: #990000">|</span> p<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">]</span> <span style="color: #990000">&lt;</span><span style="color: #990000">&lt;</span> <span style="color: #993399">16</span><span style="color: #990000">;</span>
    
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #993399">4</span><span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #990000">*</span><span style="color: #990000">(</span>Uint32 <span style="color: #990000">*</span><span style="color: #990000">)</span>p<span style="color: #990000">;</span>
    
        <span style="font-weight: bold"><span style="color: #0000FF">default</span></span><span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>


<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Locks the screen to allow direct access. This is not necessary for normal</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * sprite blitting.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">lock</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-style: italic"><span style="color: #9A1900">//Lock the screen, if necessary</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">SDL_MUSTLOCK</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>screen<span style="color: #990000">)</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">SDL_LockSurface</span></span><span style="color: #990000">(</span>screen<span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Unlocks the screen if it was locked with lock().</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> Graphics<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">unlock</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-style: italic"><span style="color: #9A1900">//Ulock the screen, if necessary</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">SDL_MUSTLOCK</span></span><span style="color: #990000">(</span>screen<span style="color: #990000">)</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">SDL_UnlockSurface</span></span><span style="color: #990000">(</span>screen<span style="color: #990000">)</span><span style="color: #990000">;</span> 
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>
</tt></pre>
