<pre><tt>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"ProjectileSustaining.h"</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Constructs a new projectile.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param name            Name of the projectile.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param description     Description of the projectile.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param price           Price of the projectile.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param ammunition      The projectiles to shoot.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param count           Number of projectiles to shoot.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param delay           Time delay between two shots.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param dispersingAngle The angle of dispersion to give some unaccuracy.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
ProjectileSustaining<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">ProjectileSustaining</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> string <span style="color: #990000">&amp;</span>name<span style="color: #990000">,</span>
                                            <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> string <span style="color: #990000">&amp;</span>description<span style="color: #990000">,</span>
                                            <span style="color: #009900">int</span> price<span style="color: #990000">,</span>
                                            <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> Projectile <span style="color: #990000">&amp;</span>ammunition<span style="color: #990000">,</span>
                                            <span style="color: #009900">int</span> count<span style="color: #990000">,</span>
                                            <span style="color: #009900">int</span> delay<span style="color: #990000">,</span>
                                            <span style="color: #009900">float</span> dispersingAngle <span style="color: #990000">)</span>
    <span style="color: #990000">:</span> <span style="font-weight: bold"><span style="color: #000000">Projectile</span></span><span style="color: #990000">(</span> name<span style="color: #990000">,</span> description<span style="color: #990000">,</span> price<span style="color: #990000">,</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">,</span> BodyExplosion<span style="color: #990000">:</span><span style="color: #990000">:</span>SMALL_GAS<span style="color: #990000">,</span>
                  ammunition<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getRadius</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span> <span style="color: #990000">)</span><span style="color: #990000">,</span>
      <span style="font-weight: bold"><span style="color: #000000">ammunition</span></span><span style="color: #990000">(</span> ammunition <span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>shotCount <span style="color: #990000">=</span> count<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>shotDelay <span style="color: #990000">=</span> delay<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>timeElapsed <span style="color: #990000">=</span> delay<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>shotsFired <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>isShot <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>dispersingAngle <span style="color: #990000">=</span> dispersingAngle<span style="color: #990000">;</span>
    
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Constructs a projectile with same properties.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param copy The projectile to use as a copy.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
ProjectileSustaining<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">ProjectileSustaining</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> ProjectileSustaining <span style="color: #990000">&amp;</span>copy<span style="color: #990000">)</span>
    <span style="color: #990000">:</span> <span style="font-weight: bold"><span style="color: #000000">Projectile</span></span><span style="color: #990000">(</span> copy <span style="color: #990000">)</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">ammunition</span></span><span style="color: #990000">(</span> copy<span style="color: #990000">.</span>ammunition <span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>shotCount <span style="color: #990000">=</span> copy<span style="color: #990000">.</span>shotCount<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>shotDelay <span style="color: #990000">=</span> copy<span style="color: #990000">.</span>shotDelay<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>timeElapsed <span style="color: #990000">=</span> copy<span style="color: #990000">.</span>shotDelay<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>shotsFired <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>isShot <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>dispersingAngle <span style="color: #990000">=</span> copy<span style="color: #990000">.</span>dispersingAngle<span style="color: #990000">;</span>
    
<span style="color: #FF0000">}</span>
    
<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Simulates the timestep for the capsule.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param timestep The step length in ms.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param capsule  The capsule, that is the projectile in the world.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> ProjectileSustaining<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">step</span></span><span style="color: #990000">(</span> <span style="color: #009900">int</span> timestep<span style="color: #990000">,</span> BodyProjectile <span style="color: #990000">&amp;</span>capsule <span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    
    <span style="color: #009900">float</span> angle<span style="color: #990000">;</span>
    Vector velocity<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="color: #990000">!</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>isShot <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>shotVelocity <span style="color: #990000">=</span> capsule<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getVelocity</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>isShot <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>

    capsule<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setVelocity</span></span><span style="color: #990000">(</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span> <span style="color: #990000">)</span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">//zero velocity</span></span>

    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>timeElapsed <span style="color: #990000">+</span><span style="color: #990000">=</span> timestep<span style="color: #990000">;</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>timeElapsed <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>shotDelay <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">//Shoot!</span></span>
        velocity <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>shotVelocity<span style="color: #990000">;</span>
        angle <span style="color: #990000">=</span> <span style="color: #990000">(</span> <span style="color: #993399">2.0</span> <span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">rand</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">/</span> RAND_MAX <span style="color: #990000">-</span> <span style="color: #993399">1.0</span> <span style="color: #990000">)</span> <span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>dispersingAngle<span style="color: #990000">;</span>
        velocity<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">rotate</span></span><span style="color: #990000">(</span> angle <span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        Projectile <span style="color: #990000">*</span>model <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>ammunition<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getCopy</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        model<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setShooter</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getShooter</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
            
        BodyProjectile <span style="color: #990000">*</span>newProjectile <span style="color: #990000">=</span>
            <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">BodyProjectile</span></span><span style="color: #990000">(</span> capsule<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getWorld</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">,</span> capsule<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getLocation</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getX</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">,</span>
                              capsule<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getLocation</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getY</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">,</span> <span style="color: #990000">*</span>model <span style="color: #990000">)</span><span style="color: #990000">;</span>

        newProjectile<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setVelocity</span></span><span style="color: #990000">(</span> velocity<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getX</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">,</span> velocity<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getY</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
        newProjectile<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">setActionFlag</span></span><span style="color: #990000">(</span> capsule<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getActionFlag</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
        capsule<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getWorld</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addBody</span></span><span style="color: #990000">(</span> <span style="color: #990000">*</span>newProjectile <span style="color: #990000">)</span><span style="color: #990000">;</span>
        capsule<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getWorld</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">playSound</span></span><span style="color: #990000">(</span> model<span style="color: #990000">-</span><span style="color: #990000">&gt;</span><span style="font-weight: bold"><span style="color: #000000">getSound</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//Time zeroed.</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>timeElapsed <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        
        <span style="font-style: italic"><span style="color: #9A1900">//One shot fired.</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>shotsFired<span style="color: #990000">+</span><span style="color: #990000">+</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>shotsFired <span style="color: #990000">&gt;</span><span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>shotCount <span style="color: #990000">)</span>
            capsule<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">destroy</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span><span style="color: #990000">;</span>
        
    <span style="color: #FF0000">}</span>
    
    Projectile<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">step</span></span><span style="color: #990000">(</span> timestep<span style="color: #990000">,</span> capsule <span style="color: #990000">)</span><span style="color: #990000">;</span>
    
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Simulates the collision between the capsule and colliding body.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param capsule       The capsule.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param collidingBody The body to collide with.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> ProjectileSustaining<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">collide</span></span><span style="color: #990000">(</span> BodyProjectile <span style="color: #990000">&amp;</span>capsule<span style="color: #990000">,</span>
                                    Body <span style="color: #990000">&amp;</span>collidingBody <span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span><span style="color: #990000">;</span>
    
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Forms a string to describe the damage of the projectile.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * @param text String to store the damage description.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">void</span> ProjectileSustaining<span style="color: #990000">:</span><span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">getDamageText</span></span><span style="color: #990000">(</span> std<span style="color: #990000">:</span><span style="color: #990000">:</span>string <span style="color: #990000">&amp;</span>text <span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span>
<span style="color: #FF0000">{</span>
    
    <span style="color: #009900">char</span> buffer<span style="color: #990000">[</span><span style="color: #993399">80</span><span style="color: #990000">]</span><span style="color: #990000">;</span>
    std<span style="color: #990000">:</span><span style="color: #990000">:</span>string damage<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>ammunition<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getDamageText</span></span><span style="color: #990000">(</span> damage <span style="color: #990000">)</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">sprintf</span></span><span style="color: #990000">(</span> buffer<span style="color: #990000">,</span> <span style="color: #FF0000">"%dx%s"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-</span><span style="color: #990000">&gt;</span>shotCount<span style="color: #990000">,</span> damage<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">c_str</span></span><span style="color: #990000">(</span><span style="color: #990000">)</span> <span style="color: #990000">)</span><span style="color: #990000">;</span>
    text <span style="color: #990000">=</span> buffer<span style="color: #990000">;</span>
    
<span style="color: #FF0000">}</span>

</tt></pre>
